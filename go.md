# Go

## 1.package and import

æ¯ä¸ª Go ç¨‹åºéƒ½ç”±åŒ…æ„æˆã€‚

ç¨‹åºä» `main` åŒ…å¼€å§‹è¿è¡Œã€‚

æœ¬ç¨‹åºé€šè¿‡å¯¼å…¥è·¯å¾„ `"fmt"` å’Œ `"math/rand"` æ¥ä½¿ç”¨è¿™ä¸¤ä¸ªåŒ…ã€‚

æŒ‰ç…§çº¦å®šï¼ŒåŒ…åä¸å¯¼å…¥è·¯å¾„çš„æœ€åä¸€ä¸ªå…ƒç´ ä¸€è‡´ã€‚ä¾‹å¦‚ï¼Œ`"math/rand"` åŒ…ä¸­çš„æºç å‡ä»¥ `package rand` è¯­å¥å¼€å§‹ã€‚

æ­¤ä»£ç ç”¨åœ†æ‹¬å·å°†å¯¼å…¥çš„åŒ…åˆ†æˆä¸€ç»„ï¼Œè¿™æ˜¯â€œåˆ†ç»„â€å½¢å¼çš„å¯¼å…¥è¯­å¥ã€‚

å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç¼–å†™å¤šä¸ªå¯¼å…¥è¯­å¥ï¼Œä¾‹å¦‚ï¼š

```go
import "fmt"
import "math"
```

ä¸è¿‡ä½¿ç”¨åˆ†ç»„å¯¼å…¥è¯­å¥è¦æ›´å¥½ã€‚

```go
package main

import (
	"fmt"
	"math/rand"
)

func main() {
	fmt.Println("æˆ‘æœ€å–œæ¬¢çš„æ•°å­—æ˜¯ ", rand.Intn(10))
}

```

```go
package main

import (
	"fmt"
	"math"
)

func main() {
	fmt.Printf("ç°åœ¨ä½ æœ‰äº† %g ä¸ªé—®é¢˜ã€‚\n", math.Sqrt(7))
}

```



## 2.å¯¼å‡ºå

åœ¨ Go ä¸­ï¼Œå¦‚æœä¸€ä¸ªåå­—ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å·²å¯¼å‡ºçš„ã€‚ä¾‹å¦‚ï¼Œ`Pizza` å°±æ˜¯ä¸ªå·²å¯¼å‡ºåï¼Œ`Pi` ä¹ŸåŒæ ·ï¼Œå®ƒå¯¼å‡ºè‡ª `math` åŒ…ã€‚

`pizza` å’Œ `pi` å¹¶æœªä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯æœªå¯¼å‡ºçš„ã€‚

åœ¨å¯¼å…¥ä¸€ä¸ªåŒ…æ—¶ï¼Œä½ åªèƒ½å¼•ç”¨å…¶ä¸­å·²å¯¼å‡ºçš„åå­—ã€‚ ä»»ä½•ã€Œæœªå¯¼å‡ºã€çš„åå­—åœ¨è¯¥åŒ…å¤–å‡æ— æ³•è®¿é—®ã€‚

æ‰§è¡Œä»£ç ï¼Œè§‚å¯Ÿé”™è¯¯ä¿¡æ¯ã€‚

è¦ä¿®å¤é”™è¯¯ï¼Œè¯·å°† `math.pi` æ”¹åä¸º `math.Pi`.

```go
package main

import (
	"fmt"
	"math"
)

func main() {
	fmt.Println(math.Pi)
}
```

## 3.å‡½æ•°

å‡½æ•°å¯æ¥å—é›¶ä¸ªæˆ–å¤šä¸ªå‚æ•°ã€‚

åœ¨æœ¬ä¾‹ä¸­ï¼Œ`add` æ¥å—ä¸¤ä¸ª `int` ç±»å‹çš„å‚æ•°ã€‚

æ³¨æ„ç±»å‹åœ¨å˜é‡åçš„ **åé¢**ã€‚

```go
package main

import "fmt"

func add(x int, y int) int {
	return x + y
}

func main() {
	fmt.Println(add(42, 13))
}
```

å½“è¿ç»­ä¸¤ä¸ªæˆ–å¤šä¸ªå‡½æ•°çš„å·²å‘½åå½¢å‚ç±»å‹ç›¸åŒæ—¶ï¼Œé™¤æœ€åä¸€ä¸ªç±»å‹ä»¥å¤–ï¼Œå…¶å®ƒéƒ½å¯ä»¥çœç•¥ã€‚

```go
package main

import "fmt"

func add(x, y int) int {
	return x + y
}

func main() {
	fmt.Println(add(42, 13))
}
```

## 4.å¤šè¿”å›å€¼

å‡½æ•°å¯ä»¥è¿”å›ä»»æ„æ•°é‡çš„è¿”å›å€¼ã€‚

`swap` å‡½æ•°è¿”å›äº†ä¸¤ä¸ªå­—ç¬¦ä¸²ã€‚

```go
package main

import "fmt"

func swap(x, y string) (string, string) {
	return y, x
}

func main() {
	a, b := swap("hello", "world")
	fmt.Println(a, b)
}
```

## 5.å¸¦åå­—çš„è¿”å›å€¼

Go çš„è¿”å›å€¼å¯è¢«å‘½åï¼Œå®ƒä»¬ä¼šè¢«è§†ä½œå®šä¹‰åœ¨å‡½æ•°é¡¶éƒ¨çš„å˜é‡ã€‚

è¿”å›å€¼çš„å‘½ååº”å½“èƒ½ååº”å…¶å«ä¹‰ï¼Œå®ƒå¯ä»¥ä½œä¸ºæ–‡æ¡£ä½¿ç”¨ã€‚

æ²¡æœ‰å‚æ•°çš„ `return` è¯­å¥ä¼šç›´æ¥è¿”å›å·²å‘½åçš„è¿”å›å€¼ï¼Œä¹Ÿå°±æ˜¯ã€Œè£¸ã€è¿”å›å€¼ã€‚

è£¸è¿”å›è¯­å¥åº”å½“ä»…ç”¨åœ¨ä¸‹é¢è¿™æ ·çš„çŸ­å‡½æ•°ä¸­ã€‚åœ¨é•¿çš„å‡½æ•°ä¸­å®ƒä»¬ä¼šå½±å“ä»£ç çš„å¯è¯»æ€§ã€‚

```go
package main

import "fmt"

func split(sum int) (x, y int) {
	x = sum * 4 / 9
	y = sum - x
	return
}

func main() {
	fmt.Println(split(17))
}

```

## 6.å˜é‡

`var` è¯­å¥ç”¨äºå£°æ˜ä¸€ç³»åˆ—å˜é‡ã€‚å’Œå‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸€æ ·ï¼Œç±»å‹åœ¨æœ€åã€‚

å¦‚ä¾‹ä¸­æ‰€ç¤ºï¼Œ`var` è¯­å¥å¯ä»¥å‡ºç°åœ¨åŒ…æˆ–å‡½æ•°çš„å±‚çº§ã€‚

```go
package main

import "fmt"

var c, python, java bool

func main() {
	var i int
	fmt.Println(i, c, python, java)
}
// 0 false false false
```

## 7.å˜é‡çš„åˆå§‹åŒ–

å˜é‡å£°æ˜å¯ä»¥åŒ…å«åˆå§‹å€¼ï¼Œæ¯ä¸ªå˜é‡å¯¹åº”ä¸€ä¸ªã€‚

å¦‚æœæä¾›äº†åˆå§‹å€¼ï¼Œåˆ™ç±»å‹å¯ä»¥çœç•¥ï¼›å˜é‡ä¼šä»åˆå§‹å€¼ä¸­æ¨æ–­å‡ºç±»å‹ã€‚

```go
package main

import "fmt"

var i, j int = 1, 2

func main() {
	var c, python, java = true, false, "no!"
	fmt.Println(i, j, c, python, java)
}
```

```go
func main() {
    x := 100 // ğŸ†• æ–°ç”¨æˆ·æ³¨å†Œ (å£°æ˜+åˆå§‹åŒ–)
    x = 3    // ğŸ”„ è€ç”¨æˆ·æ”¹å (ä»…èµ‹å€¼)
    
    // x := 3 // ğŸ’¥ æŠ¥é”™: "no new variables on left side of :="
    // å› ä¸º x å·²ç»åœ¨è¿™ä¸€å±‚ä½œç”¨åŸŸå­˜åœ¨äº†ï¼Œä¸èƒ½é‡å¤â€œå‡ºç”Ÿâ€ã€‚
}
```

## 8.çŸ­å˜é‡å£°æ˜

åœ¨å‡½æ•°ä¸­ï¼ŒçŸ­èµ‹å€¼è¯­å¥ `:=` å¯åœ¨éšå¼ç¡®å®šç±»å‹çš„ `var` å£°æ˜ä¸­ä½¿ç”¨ã€‚

å‡½æ•°å¤–çš„æ¯ä¸ªè¯­å¥éƒ½ **å¿…é¡»** ä»¥å…³é”®å­—å¼€å§‹ï¼ˆ`var`ã€`func` ç­‰ï¼‰ï¼Œå› æ­¤ `:=` ç»“æ„ä¸èƒ½åœ¨å‡½æ•°å¤–ä½¿ç”¨ã€‚

```go
package main

import "fmt"

func main() {
	var i, j int = 1, 2
	k := 3
	c, python, java := true, false, "no!"

	fmt.Println(i, j, k, c, python, java)
}
```

## 9.åŸºæœ¬ç±»å‹

Go çš„åŸºæœ¬ç±»å‹æœ‰

```go
bool

string

int  int8  int16  int32  int64
uint uint8 uint16 uint32 uint64 uintptr

byte // uint8 çš„åˆ«å

rune // int32 çš„åˆ«å
     // è¡¨ç¤ºä¸€ä¸ª Unicode ç ä½

float32 float64

complex64 complex128
```

æœ¬ä¾‹å±•ç¤ºäº†å‡ ç§ç±»å‹çš„å˜é‡ã€‚ å’Œå¯¼å…¥è¯­å¥ä¸€æ ·ï¼Œå˜é‡å£°æ˜ä¹Ÿå¯ä»¥ã€Œåˆ†ç»„ã€æˆä¸€ä¸ªä»£ç å—ã€‚

`int`ã€`uint` å’Œ `uintptr` ç±»å‹åœ¨ 32-ä½ç³»ç»Ÿä¸Šé€šå¸¸ä¸º 32-ä½å®½ï¼Œåœ¨ 64-ä½ç³»ç»Ÿä¸Šåˆ™ä¸º 64-ä½å®½ã€‚å½“ä½ éœ€è¦ä¸€ä¸ªæ•´æ•°å€¼æ—¶åº”ä½¿ç”¨ `int` ç±»å‹ï¼Œ é™¤éä½ æœ‰ç‰¹æ®Šçš„ç†ç”±ä½¿ç”¨å›ºå®šå¤§å°æˆ–æ— ç¬¦å·çš„æ•´æ•°ç±»å‹ã€‚

```go
package main

import (
	"fmt"
	"math/cmplx"
)

var (
	ToBe   bool       = false
	MaxInt uint64     = 1<<64 - 1
	z      complex128 = cmplx.Sqrt(-5 + 12i)
)

func main() {
	fmt.Printf("ç±»å‹ï¼š%T å€¼ï¼š%v\n", ToBe, ToBe)
	fmt.Printf("ç±»å‹ï¼š%T å€¼ï¼š%v\n", MaxInt, MaxInt)
	fmt.Printf("ç±»å‹ï¼š%T å€¼ï¼š%v\n", z, z)
}
//ç±»å‹ï¼šbool å€¼ï¼šfalse
//ç±»å‹ï¼šuint64 å€¼ï¼š18446744073709551615
//ç±»å‹ï¼šcomplex128 å€¼ï¼š(2+3i)
```

## 10.é›¶å€¼

æ²¡æœ‰æ˜ç¡®åˆå§‹åŒ–çš„å˜é‡å£°æ˜ä¼šè¢«èµ‹äºˆå¯¹åº”ç±»å‹çš„ **é›¶å€¼**ã€‚

é›¶å€¼æ˜¯ï¼š

- æ•°å€¼ç±»å‹ä¸º `0`ï¼Œ
- å¸ƒå°”ç±»å‹ä¸º `false`ï¼Œ
- å­—ç¬¦ä¸²ä¸º `""`ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ã€‚

```go
package main

import "fmt"

func main() {
	var i int
	var f float64
	var b bool
	var s string
	fmt.Printf("%v %v %v %q\n", i, f, b, s)
}
```

## 11.ç±»å‹è½¬æ¢

è¡¨è¾¾å¼ `T(v)` å°†å€¼ `v` è½¬æ¢ä¸ºç±»å‹ `T`ã€‚

ä¸€äº›æ•°å€¼ç±»å‹çš„è½¬æ¢ï¼š

```go
var i int = 42
var f float64 = float64(i)
var u uint = uint(f)
```

æˆ–è€…ï¼Œæ›´åŠ ç®€çŸ­çš„å½¢å¼ï¼š

```go
i := 42
f := float64(i)
u := uint(f)
```

ä¸ C ä¸åŒçš„æ˜¯ï¼ŒGo åœ¨ä¸åŒç±»å‹çš„é¡¹ä¹‹é—´èµ‹å€¼æ—¶éœ€è¦æ˜¾å¼è½¬æ¢ã€‚è¯•ç€ç§»é™¤ä¾‹å­ä¸­çš„ `float64` æˆ– `uint` çš„ç±»å‹è½¬æ¢ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚

```go
package main

import (
	"fmt"
	"math"
)

func main() {
	var x, y int = 3, 4
	var f float64 = math.Sqrt(float64(x*x + y*y))
	var z uint = uint(f)
	fmt.Println(x, y, z)
}
```

## 12.ç±»å‹æ¨æ–­

åœ¨å£°æ˜ä¸€ä¸ªå˜é‡è€Œä¸æŒ‡å®šå…¶ç±»å‹æ—¶ï¼ˆå³ä½¿ç”¨ä¸å¸¦ç±»å‹çš„ `:=` è¯­æ³• `var =` è¡¨è¾¾å¼è¯­æ³•ï¼‰ï¼Œå˜é‡çš„ç±»å‹ä¼šé€šè¿‡å³å€¼æ¨æ–­å‡ºæ¥ã€‚

å½“å£°æ˜çš„å³å€¼ç¡®å®šäº†ç±»å‹æ—¶ï¼Œæ–°å˜é‡çš„ç±»å‹ä¸å…¶ç›¸åŒï¼š

```go
var i int
j := i // j ä¹Ÿæ˜¯ä¸€ä¸ª int
```

ä¸è¿‡å½“å³è¾¹åŒ…å«æœªæŒ‡æ˜ç±»å‹çš„æ•°å€¼å¸¸é‡æ—¶ï¼Œæ–°å˜é‡çš„ç±»å‹å°±å¯èƒ½æ˜¯ `int`ã€`float64` æˆ– `complex128` äº†ï¼Œè¿™å–å†³äºå¸¸é‡çš„ç²¾åº¦ï¼š

```go
i := 42           // int
f := 3.142        // float64
g := 0.867 + 0.5i // complex128
```

è¯•ç€ä¿®æ”¹ç¤ºä¾‹ä»£ç ä¸­ `v` çš„åˆå§‹å€¼ï¼Œå¹¶è§‚å¯Ÿå®ƒæ˜¯å¦‚ä½•å½±å“ç±»å‹çš„ã€‚

```go
package main

import "fmt"

func main() {
	v := 42 // ä¿®æ”¹è¿™é‡Œçœ‹çœ‹ï¼
	fmt.Printf("v is of type %T\n", v)
}
```

## 13.å¸¸é‡

å¸¸é‡çš„å£°æ˜ä¸å˜é‡ç±»ä¼¼ï¼Œåªä¸è¿‡ä½¿ç”¨ `const` å…³é”®å­—ã€‚

å¸¸é‡å¯ä»¥æ˜¯å­—ç¬¦ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼æˆ–æ•°å€¼ã€‚

å¸¸é‡ä¸èƒ½ç”¨ `:=` è¯­æ³•å£°æ˜ã€‚

```go
package main

import "fmt"

const Pi = 3.14

func main() {
	const World = "ä¸–ç•Œ"
	fmt.Println("Hello", World)
	fmt.Println("Happy", Pi, "Day")

	const Truth = true
	fmt.Println("Go rules?", Truth)
}
```

## 14.æ•°å€¼å¸¸é‡

æ•°å€¼å¸¸é‡æ˜¯é«˜ç²¾åº¦çš„**å€¼**ã€‚

ä¸€ä¸ªæœªæŒ‡å®šç±»å‹çš„å¸¸é‡ç”±ä¸Šä¸‹æ–‡æ¥å†³å®šå…¶ç±»å‹ã€‚

å†è¯•ç€ä¸€ä¸‹è¾“å‡º `needInt(Big)` å§ã€‚

ï¼ˆ`int` ç±»å‹å¯ä»¥å­˜å‚¨æœ€å¤§ 64 ä½çš„æ•´æ•°ï¼Œæ ¹æ®å¹³å°ä¸åŒæœ‰æ—¶ä¼šæ›´å°ã€‚ï¼‰

```go
package main

import "fmt"

const (
	// å°† 1 å·¦ç§» 100 ä½æ¥åˆ›å»ºä¸€ä¸ªéå¸¸å¤§çš„æ•°å­—
	// å³è¿™ä¸ªæ•°çš„äºŒè¿›åˆ¶æ˜¯ 1 åé¢è·Ÿç€ 100 ä¸ª 0
	Big = 1 << 100
	// å†å¾€å³ç§» 99 ä½ï¼Œå³ Small = 1 << 1ï¼Œæˆ–è€…è¯´ Small = 2
	Small = Big >> 99
)

func needInt(x int) int { return x*10 + 1 }
func needFloat(x float64) float64 {
	return x * 0.1
}

func main() {
	fmt.Println(needInt(Small))
	fmt.Println(needFloat(Small))
	fmt.Println(needFloat(Big))
}
//21
//0.2
//1.2676506002282295e+29
```

---

## 15.forå¾ªç¯

Go åªæœ‰ä¸€ç§å¾ªç¯ç»“æ„ï¼š`for` å¾ªç¯ã€‚

åŸºæœ¬çš„ `for` å¾ªç¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå®ƒä»¬ç”¨åˆ†å·éš”å¼€ï¼š

- åˆå§‹åŒ–è¯­å¥ï¼šåœ¨ç¬¬ä¸€æ¬¡è¿­ä»£å‰æ‰§è¡Œ
- æ¡ä»¶è¡¨è¾¾å¼ï¼šåœ¨æ¯æ¬¡è¿­ä»£å‰æ±‚å€¼
- åç½®è¯­å¥ï¼šåœ¨æ¯æ¬¡è¿­ä»£çš„ç»“å°¾æ‰§è¡Œ

åˆå§‹åŒ–è¯­å¥é€šå¸¸ä¸ºä¸€å¥çŸ­å˜é‡å£°æ˜ï¼Œè¯¥å˜é‡å£°æ˜ä»…åœ¨ `for` è¯­å¥çš„ä½œç”¨åŸŸä¸­å¯è§ã€‚

ä¸€æ—¦æ¡ä»¶è¡¨è¾¾å¼æ±‚å€¼ä¸º `false`ï¼Œå¾ªç¯è¿­ä»£å°±ä¼šç»ˆæ­¢ã€‚

**æ³¨æ„**ï¼šå’Œ Cã€Javaã€JavaScript ä¹‹ç±»çš„è¯­è¨€ä¸åŒï¼ŒGo çš„ `for` è¯­å¥åé¢çš„ä¸‰ä¸ªæ„æˆéƒ¨åˆ†å¤–æ²¡æœ‰å°æ‹¬å·ï¼Œ å¤§æ‹¬å· `{ }` åˆ™æ˜¯å¿…é¡»çš„ã€‚

```go
package main

import "fmt"

func main() {
	sum := 0
	for i := 0; i < 10; i++ {
		sum += i
	}
	fmt.Println(sum)
}
```

**åˆå§‹åŒ–è¯­å¥å’Œåç½®è¯­å¥æ˜¯å¯é€‰çš„ã€‚**

```go
package main

import "fmt"

func main() {
	sum := 1
	for ; sum < 1000; {
		sum += sum
	}
	fmt.Println(sum)
}
```

**for æ˜¯ Go ä¸­çš„ã€Œwhileã€**

æ­¤æ—¶ä½ å¯ä»¥å»æ‰åˆ†å·ï¼Œå› ä¸º C çš„ `while` åœ¨ Go ä¸­å«åš `for`ã€‚

```go
package main

import "fmt"

func main() {
	sum := 1
	for sum < 1000 {
		sum += sum
	}
	fmt.Println(sum)
}

```

## 16.æ— é™å¾ªç¯

å¦‚æœçœç•¥å¾ªç¯æ¡ä»¶ï¼Œè¯¥å¾ªç¯å°±ä¸ä¼šç»“æŸï¼Œå› æ­¤æ— é™å¾ªç¯å¯ä»¥å†™å¾—å¾ˆç´§å‡‘ã€‚

```go
package main

func main() {
	for {
	}
}
```

## 17.if åˆ¤æ–­

Go çš„ `if` è¯­å¥ä¸ `for` å¾ªç¯ç±»ä¼¼ï¼Œè¡¨è¾¾å¼å¤–æ— éœ€å°æ‹¬å· `( )`ï¼Œè€Œå¤§æ‹¬å· `{ }` åˆ™æ˜¯å¿…é¡»çš„ã€‚

```go
package main

import (
	"fmt"
	"math"
)

func sqrt(x float64) string {
	if x < 0 {
		return sqrt(-x) + "i"
	}
	return fmt.Sprint(math.Sqrt(x))
}

func main() {
	fmt.Println(sqrt(2), sqrt(-4))
}
```

## 18.if å’Œç®€çŸ­è¯­å¥

å’Œ `for` ä¸€æ ·ï¼Œ`if` è¯­å¥å¯ä»¥åœ¨æ¡ä»¶è¡¨è¾¾å¼å‰æ‰§è¡Œä¸€ä¸ªç®€çŸ­è¯­å¥ã€‚

è¯¥è¯­å¥å£°æ˜çš„å˜é‡ä½œç”¨åŸŸä»…åœ¨ `if` ä¹‹å†…ã€‚

ï¼ˆåœ¨æœ€åçš„ `return` è¯­å¥å¤„ä½¿ç”¨ `v` çœ‹çœ‹,ä¼šæŠ¥é”™ã€‚ï¼‰

```go
package main

import (
	"fmt"
	"math"
)

func pow(x, n, lim float64) float64 {
	if v := math.Pow(x, n); v < lim {
		return v
	}
	return lim
}

func main() {
	fmt.Println(
		pow(3, 2, 10),
		pow(3, 3, 20),
	)
}
```

## 19.if å’Œ else

åœ¨ `if` çš„ç®€çŸ­è¯­å¥ä¸­å£°æ˜çš„å˜é‡åŒæ ·å¯ä»¥åœ¨å¯¹åº”çš„ä»»ä½• `else` å—ä¸­ä½¿ç”¨ã€‚

ï¼ˆåœ¨ `main` çš„ `fmt.Println` è°ƒç”¨å¼€å§‹å‰ï¼Œä¸¤æ¬¡å¯¹ `pow` çš„è°ƒç”¨å‡å·²æ‰§è¡Œå¹¶è¿”å›å…¶å„è‡ªçš„ç»“æœã€‚ï¼‰

```go
package main

import (
	"fmt"
	"math"
)

func pow(x, n, lim float64) float64 {
	if v := math.Pow(x, n); v < lim {
		return v
	} else {
		fmt.Printf("%g >= %g\n", v, lim)
	}
	// can't use v here, though
	return lim
}

func main() {
	fmt.Println(
		pow(3, 2, 10),
		pow(3, 3, 20),
	)
}
//27 >= 20
//9 20
```

## 20.switchåˆ†æ”¯

`switch` è¯­å¥æ˜¯ç¼–å†™ä¸€è¿ä¸² `if - else` è¯­å¥çš„ç®€ä¾¿æ–¹æ³•ã€‚å®ƒè¿è¡Œç¬¬ä¸€ä¸ª `case` å€¼ å€¼ç­‰äºæ¡ä»¶è¡¨è¾¾å¼çš„å­å¥ã€‚

Go çš„ `switch` è¯­å¥ç±»ä¼¼äº Cã€C++ã€Javaã€JavaScript å’Œ PHP ä¸­çš„ï¼Œä¸è¿‡ Go åªä¼šè¿è¡Œé€‰å®šçš„ `case`ï¼Œè€Œéä¹‹åæ‰€æœ‰çš„ `case`ã€‚ åœ¨æ•ˆæœä¸Šï¼ŒGo çš„åšæ³•ç›¸å½“äºè¿™äº›è¯­è¨€ä¸­ä¸ºæ¯ä¸ª `case` åé¢è‡ªåŠ¨æ·»åŠ äº†æ‰€éœ€çš„ `break` è¯­å¥ã€‚åœ¨ Go ä¸­ï¼Œé™¤éä»¥ `fallthrough` è¯­å¥ç»“æŸï¼Œå¦åˆ™åˆ†æ”¯ä¼šè‡ªåŠ¨ç»ˆæ­¢ã€‚ Go çš„å¦ä¸€ç‚¹é‡è¦çš„ä¸åŒåœ¨äº `switch` çš„ `case` æ— éœ€ä¸ºå¸¸é‡ï¼Œä¸”å–å€¼ä¸é™äºæ•´æ•°ã€‚

```go
package main

import (
	"fmt"
	"runtime"
)

func main() {
	fmt.Print("Go è¿è¡Œçš„ç³»ç»Ÿç¯å¢ƒï¼š")
	switch os := runtime.GOOS; os {
	case "darwin":
		fmt.Println("macOS.")
	case "linux":
		fmt.Println("Linux.")
	default:
		// freebsd, openbsd,
		// plan9, windows...
		fmt.Printf("%s.\n", os)
	}
}
```

## 21.switchçš„æ±‚å€¼é¡ºåº

`switch` çš„ `case` è¯­å¥ä»ä¸Šåˆ°ä¸‹é¡ºæ¬¡æ‰§è¡Œï¼Œç›´åˆ°åŒ¹é…æˆåŠŸæ—¶åœæ­¢ã€‚

ä¾‹å¦‚ï¼Œ

```go
switch i {
case 0:
case f():
}
```

åœ¨ `i==0` æ—¶ï¼Œ`f` ä¸ä¼šè¢«è°ƒç”¨ã€‚ï¼‰

**æ³¨æ„**ï¼š Go ç»ƒä¹ åœºä¸­çš„æ—¶é—´æ€»æ˜¯ä» 2009-11-10 23:00:00 UTC å¼€å§‹ï¼Œ è¯¥å€¼çš„æ„ä¹‰ç•™ç»™è¯»è€…å»å‘ç°ã€‚

```go
package main

import (
	"fmt"
	"time"
)

func main() {
	fmt.Println("å‘¨å…­æ˜¯å“ªå¤©ï¼Ÿ")
	today := time.Now().Weekday()
	switch time.Saturday {
	case today + 0:
		fmt.Println("ä»Šå¤©ã€‚")
	case today + 1:
		fmt.Println("æ˜å¤©ã€‚")
	case today + 2:
		fmt.Println("åå¤©ã€‚")
	default:
		fmt.Println("å¾ˆå¤šå¤©åã€‚")
	}
}
```

## 22.æ— æ¡ä»¶ switch

æ— æ¡ä»¶çš„ `switch` åŒ `switch true` ä¸€æ ·ã€‚

è¿™ç§å½¢å¼èƒ½å°†ä¸€é•¿ä¸² `if-then-else` å†™å¾—æ›´åŠ æ¸…æ™°ã€‚

```go
package main

import (
	"fmt"
	"time"
)

func main() {
	t := time.Now()
	switch {
	case t.Hour() < 12:
		fmt.Println("æ—©ä¸Šå¥½ï¼")
	case t.Hour() < 17:
		fmt.Println("ä¸‹åˆå¥½ï¼")
	default:
		fmt.Println("æ™šä¸Šå¥½ï¼")
	}
}
```

## 23.defer æ¨è¿Ÿ

defer è¯­å¥ä¼šå°†å‡½æ•°æ¨è¿Ÿåˆ°å¤–å±‚å‡½æ•°è¿”å›ä¹‹åæ‰§è¡Œã€‚

æ¨è¿Ÿè°ƒç”¨çš„å‡½æ•°å…¶å‚æ•°ä¼šç«‹å³æ±‚å€¼ï¼Œä½†ç›´åˆ°å¤–å±‚å‡½æ•°è¿”å›å‰è¯¥å‡½æ•°éƒ½ä¸ä¼šè¢«è°ƒç”¨ã€‚

```go
package main

import "fmt"

func main() {
	defer fmt.Println("world")

	fmt.Println("hello")
}

```

## 24.defer æ ˆ

æ¨è¿Ÿè°ƒç”¨çš„å‡½æ•°è°ƒç”¨ä¼šè¢«å‹å…¥ä¸€ä¸ªæ ˆä¸­ã€‚ å½“å¤–å±‚å‡½æ•°è¿”å›æ—¶ï¼Œè¢«æ¨è¿Ÿçš„è°ƒç”¨ä¼šæŒ‰ç…§åè¿›å…ˆå‡ºçš„é¡ºåºè°ƒç”¨ã€‚

æ›´å¤šå…³äº defer è¯­å¥çš„ä¿¡æ¯ï¼Œè¯·é˜…è¯»[æ­¤åšæ–‡](http://blog.go-zh.org/defer-panic-and-recover)ã€‚

```go
package main

import "fmt"

func main() {
	fmt.Println("counting")

	for i := 0; i < 10; i++ {
		defer fmt.Println(i)
	}

	fmt.Println("done")
}

//counting
//done
//9
//8
//7
//6
//5
//4
//3
//2
//1
//0
```

## 25.æŒ‡é’ˆ

Go æ‹¥æœ‰æŒ‡é’ˆã€‚æŒ‡é’ˆä¿å­˜äº†å€¼çš„å†…å­˜åœ°å€ã€‚

ç±»å‹ `*T` æ˜¯æŒ‡å‘ `T` ç±»å‹å€¼çš„æŒ‡é’ˆï¼Œå…¶é›¶å€¼ä¸º `nil`ã€‚

```go
var p *int
```

`&` æ“ä½œç¬¦ä¼šç”Ÿæˆä¸€ä¸ªæŒ‡å‘å…¶æ“ä½œæ•°çš„æŒ‡é’ˆã€‚

```go
i := 42
p = &i
```

`*` æ“ä½œç¬¦è¡¨ç¤ºæŒ‡é’ˆæŒ‡å‘çš„åº•å±‚å€¼ã€‚

```go
fmt.Println(*p) // é€šè¿‡æŒ‡é’ˆ p è¯»å– i
*p = 21         // é€šè¿‡æŒ‡é’ˆ p è®¾ç½® i
```

è¿™ä¹Ÿå°±æ˜¯é€šå¸¸æ‰€è¯´çš„ã€Œè§£å¼•ç”¨ã€æˆ–ã€Œé—´æ¥å¼•ç”¨ã€ã€‚

ä¸ C ä¸åŒï¼ŒGo æ²¡æœ‰æŒ‡é’ˆè¿ç®—ã€‚

```go
package main

import "fmt"

func main() {
	i, j := 42, 2701

	p := &i         // æŒ‡å‘ i
	fmt.Println(*p) // é€šè¿‡æŒ‡é’ˆè¯»å– i çš„å€¼
	*p = 21         // é€šè¿‡æŒ‡é’ˆè®¾ç½® i çš„å€¼
	fmt.Println(i)  // æŸ¥çœ‹ i çš„å€¼

	p = &j         // æŒ‡å‘ j
	*p = *p / 37   // é€šè¿‡æŒ‡é’ˆå¯¹ j è¿›è¡Œé™¤æ³•è¿ç®—
	fmt.Println(j) // æŸ¥çœ‹ j çš„å€¼
}
```

## 26.ç»“æ„ä½“

ä¸€ä¸ª ç»“æ„ä½“ï¼ˆ`struct`ï¼‰å°±æ˜¯ä¸€ç»„å­—æ®µï¼ˆfieldï¼‰ã€‚

```go
package main

import "fmt"

type Vertex struct {
	X int
	Y int
}

func main() {
	fmt.Println(Vertex{1, 2})
}
```

## 27.ç»“æ„ä½“å­—æ®µ

ç»“æ„ä½“å­—æ®µå¯é€šè¿‡ç‚¹å· `.` æ¥è®¿é—®ã€‚

```go
package main

import "fmt"

type Vertex struct {
	X int
	Y int
}

func main() {
	v := Vertex{1, 2}
	v.X = 4
	fmt.Println(v.X)
}
```

## 28.ç»“æ„ä½“æŒ‡é’ˆ

ç»“æ„ä½“å­—æ®µå¯é€šè¿‡ç»“æ„ä½“æŒ‡é’ˆæ¥è®¿é—®ã€‚

å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆ `p` é‚£ä¹ˆå¯ä»¥é€šè¿‡ `(*p).X` æ¥è®¿é—®å…¶å­—æ®µ `X`ã€‚ ä¸è¿‡è¿™ä¹ˆå†™å¤ªå•°å—¦äº†ï¼Œæ‰€ä»¥è¯­è¨€ä¹Ÿå…è®¸æˆ‘ä»¬ä½¿ç”¨éšå¼è§£å¼•ç”¨ï¼Œç›´æ¥å†™ `p.X` å°±å¯ä»¥ã€‚

```go
package main

import "fmt"

type Vertex struct {
	X int
	Y int
}

func main() {
	v := Vertex{1, 2}
	p := &v
	p.X = 1e9
	fmt.Println(v)
}
```

## 29.ç»“æ„ä½“å­—é¢é‡

ä½¿ç”¨ `Name:` è¯­æ³•å¯ä»¥ä»…åˆ—å‡ºéƒ¨åˆ†å­—æ®µï¼ˆå­—æ®µåçš„é¡ºåºæ— å…³ï¼‰ã€‚

ç‰¹æ®Šçš„å‰ç¼€ `&` è¿”å›ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆã€‚

```go
package main

import "fmt"

type Vertex struct {
	X, Y int
}

var (
	v1 = Vertex{1, 2}  // åˆ›å»ºä¸€ä¸ª Vertex ç±»å‹çš„ç»“æ„ä½“
	v2 = Vertex{X: 1}  // Y:0 è¢«éšå¼åœ°èµ‹äºˆé›¶å€¼
	v3 = Vertex{}      // X:0 Y:0
	p  = &Vertex{1, 2} // åˆ›å»ºä¸€ä¸ª *Vertex ç±»å‹çš„ç»“æ„ä½“ï¼ˆæŒ‡é’ˆï¼‰
)

func main() {
	fmt.Println(v1, p, v2, v3)
}
//{1 2} &{1 2} {1 0} {0 0}
```

## 30.æ•°ç»„

ç±»å‹ `[n]T` è¡¨ç¤ºä¸€ä¸ªæ•°ç»„ï¼Œå®ƒæ‹¥æœ‰ `n` ä¸ªç±»å‹ä¸º `T` çš„å€¼ã€‚

è¡¨è¾¾å¼

```go
var a [10]int
```

ä¼šå°†å˜é‡ `a` å£°æ˜ä¸ºæ‹¥æœ‰ 10 ä¸ªæ•´æ•°çš„æ•°ç»„ã€‚

æ•°ç»„çš„é•¿åº¦æ˜¯å…¶ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤æ•°ç»„ä¸èƒ½æ”¹å˜å¤§å°ã€‚ è¿™çœ‹èµ·æ¥æ˜¯ä¸ªé™åˆ¶ï¼Œä¸è¿‡æ²¡å…³ç³»ï¼ŒGo æ‹¥æœ‰æ›´åŠ æ–¹ä¾¿çš„ä½¿ç”¨æ•°ç»„çš„æ–¹å¼ã€‚

```go
package main

import "fmt"

func main() {
	var a [2]string
	a[0] = "Hello"
	a[1] = "World"
	fmt.Println(a[0], a[1])
	fmt.Println(a)

	primes := [6]int{2, 3, 5, 7, 11, 13}
	fmt.Println(primes)
}

//Hello World
//[Hello World]
//[2 3 5 7 11 13]
```

## 31.åˆ‡ç‰‡

æ¯ä¸ªæ•°ç»„çš„å¤§å°éƒ½æ˜¯å›ºå®šçš„ã€‚è€Œåˆ‡ç‰‡åˆ™ä¸ºæ•°ç»„å…ƒç´ æä¾›äº†åŠ¨æ€å¤§å°çš„ã€çµæ´»çš„è§†è§’ã€‚ åœ¨å®è·µä¸­ï¼Œåˆ‡ç‰‡æ¯”æ•°ç»„æ›´å¸¸ç”¨ã€‚

ç±»å‹ `[]T` è¡¨ç¤ºä¸€ä¸ªå…ƒç´ ç±»å‹ä¸º `T` çš„åˆ‡ç‰‡ã€‚

åˆ‡ç‰‡é€šè¿‡ä¸¤ä¸ªä¸‹æ ‡æ¥ç•Œå®šï¼Œä¸€ä¸ªä¸‹ç•Œå’Œä¸€ä¸ªä¸Šç•Œï¼ŒäºŒè€…ä»¥å†’å·åˆ†éš”ï¼š

```go
a[low : high]
```

å®ƒä¼šé€‰å‡ºä¸€ä¸ªåŠé—­åŠå¼€åŒºé—´ï¼ŒåŒ…æ‹¬ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä½†æ’é™¤æœ€åä¸€ä¸ªå…ƒç´ ã€‚

ä»¥ä¸‹è¡¨è¾¾å¼åˆ›å»ºäº†ä¸€ä¸ªåˆ‡ç‰‡ï¼Œå®ƒåŒ…å« `a` ä¸­ä¸‹æ ‡ä» 1 åˆ° 3 çš„å…ƒç´ ï¼š

```go
a[1:4]
```

```go
package main

import "fmt"

func main() {
	primes := [6]int{2, 3, 5, 7, 11, 13}

	var s []int = primes[1:4]
	fmt.Println(s)
}

//[3 5 7]
```

## 32.åˆ‡ç‰‡ç±»ä¼¼æ•°ç»„çš„å¼•ç”¨

åˆ‡ç‰‡å°±åƒæ•°ç»„çš„å¼•ç”¨åˆ‡ç‰‡å¹¶ä¸å­˜å‚¨ä»»ä½•æ•°æ®ï¼Œå®ƒåªæ˜¯æè¿°äº†åº•å±‚æ•°ç»„ä¸­çš„ä¸€æ®µã€‚

æ›´æ”¹åˆ‡ç‰‡çš„å…ƒç´ ä¼šä¿®æ”¹å…¶åº•å±‚æ•°ç»„ä¸­å¯¹åº”çš„å…ƒç´ ã€‚

å’Œå®ƒå…±äº«åº•å±‚æ•°ç»„çš„åˆ‡ç‰‡éƒ½ä¼šè§‚æµ‹åˆ°è¿™äº›ä¿®æ”¹ã€‚

```go
package main

import "fmt"

func main() {
	names := [4]string{
		"John",
		"Paul",
		"George",
		"Ringo",
	}
	fmt.Println(names)

	a := names[0:2]
	b := names[1:3]
	fmt.Println(a, b)

	b[0] = "XXX"
	fmt.Println(a, b)
	fmt.Println(names)
}

//[John Paul George Ringo]
//[John Paul] [Paul George]
//[John XXX] [XXX George]
//[John XXX George Ringo]
```

## 33.åˆ‡ç‰‡å­—é¢é‡

åˆ‡ç‰‡å­—é¢é‡ç±»ä¼¼äºæ²¡æœ‰é•¿åº¦çš„æ•°ç»„å­—é¢é‡ã€‚

è¿™æ˜¯ä¸€ä¸ªæ•°ç»„å­—é¢é‡ï¼š

```go
[3]bool{true, true, false}
```

ä¸‹é¢è¿™æ ·åˆ™ä¼šåˆ›å»ºä¸€ä¸ªå’Œä¸Šé¢ç›¸åŒçš„æ•°ç»„ï¼Œç„¶åå†æ„å»ºä¸€ä¸ªå¼•ç”¨äº†å®ƒçš„åˆ‡ç‰‡ï¼š

```go
[]bool{true, true, false}
```

```go
package main

import "fmt"

func main() {
	q := []int{2, 3, 5, 7, 11, 13}
	fmt.Println(q)

	r := []bool{true, false, true, true, false, true}
	fmt.Println(r)

	s := []struct {
		i int
		b bool
	}{
		{2, true},
		{3, false},
		{5, true},
		{7, true},
		{11, false},
		{13, true},
	}
	fmt.Println(s)
}
```

```go
[2 3 5 7 11 13]
[true false true true false true]
[{2 true} {3 false} {5 true} {7 true} {11 false} {13 true}]
```

## 34.åˆ‡ç‰‡çš„é»˜è®¤è¡Œä¸º

åœ¨è¿›è¡Œåˆ‡ç‰‡æ—¶ï¼Œä½ å¯ä»¥åˆ©ç”¨å®ƒçš„é»˜è®¤è¡Œä¸ºæ¥å¿½ç•¥ä¸Šä¸‹ç•Œã€‚

åˆ‡ç‰‡ä¸‹ç•Œçš„é»˜è®¤å€¼ä¸º 0ï¼Œä¸Šç•Œåˆ™æ˜¯è¯¥åˆ‡ç‰‡çš„é•¿åº¦ã€‚

å¯¹äºæ•°ç»„

```go
var a [10]int
```

æ¥è¯´ï¼Œä»¥ä¸‹åˆ‡ç‰‡è¡¨è¾¾å¼å’Œå®ƒæ˜¯ç­‰ä»·çš„ï¼š

```go
a[0:10]
a[:10]
a[0:]
a[:]
```

```go
package main

import "fmt"

func main() {
	s := []int{2, 3, 5, 7, 11, 13}

	s = s[1:4]
	fmt.Println(s)

	s = s[:2]
	fmt.Println(s)

	s = s[1:]
	fmt.Println(s)
}
```

```go
[3 5 7]
[3 5]
[5]
```

## 35.åˆ‡ç‰‡çš„é•¿åº¦ä¸å®¹é‡

åˆ‡ç‰‡æ‹¥æœ‰ **é•¿åº¦** å’Œ **å®¹é‡**ã€‚

åˆ‡ç‰‡çš„é•¿åº¦å°±æ˜¯å®ƒæ‰€åŒ…å«çš„å…ƒç´ ä¸ªæ•°ã€‚

åˆ‡ç‰‡çš„å®¹é‡æ˜¯ä»å®ƒçš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹æ•°ï¼Œåˆ°å…¶åº•å±‚æ•°ç»„å…ƒç´ æœ«å°¾çš„ä¸ªæ•°ã€‚

åˆ‡ç‰‡ `s` çš„é•¿åº¦å’Œå®¹é‡å¯é€šè¿‡è¡¨è¾¾å¼ `len(s)` å’Œ `cap(s)` æ¥è·å–ã€‚

ä½ å¯ä»¥é€šè¿‡é‡æ–°åˆ‡ç‰‡æ¥æ‰©å±•ä¸€ä¸ªåˆ‡ç‰‡ï¼Œç»™å®ƒæä¾›è¶³å¤Ÿçš„å®¹é‡ã€‚ è¯•ç€ä¿®æ”¹ç¤ºä¾‹ç¨‹åºä¸­çš„åˆ‡ç‰‡æ“ä½œï¼Œå‘å¤–æ‰©å±•å®ƒçš„é•¿åº¦ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚

```go
package main

import "fmt"

func main() {
	s := []int{2, 3, 5, 7, 11, 13}
	printSlice(s)

	// æˆªå–åˆ‡ç‰‡ä½¿å…¶é•¿åº¦ä¸º 0
	s = s[:0]
	printSlice(s)

	// æ‰©å±•å…¶é•¿åº¦
	s = s[:4]
	printSlice(s)

	// èˆå¼ƒå‰ä¸¤ä¸ªå€¼
	s = s[2:]
	printSlice(s)
}

func printSlice(s []int) {
	fmt.Printf("len=%d cap=%d %v\n", len(s), cap(s), s)
}
```

```go
len=6 cap=6 [2 3 5 7 11 13]
len=0 cap=6 []
len=4 cap=6 [2 3 5 7]
len=2 cap=4 [5 7]
```

## 36.nil åˆ‡ç‰‡

åˆ‡ç‰‡çš„é›¶å€¼æ˜¯ `nil`ã€‚

nil åˆ‡ç‰‡çš„é•¿åº¦å’Œå®¹é‡ä¸º 0 ä¸”æ²¡æœ‰åº•å±‚æ•°ç»„ã€‚

```go
package main

import "fmt"

func main() {
	var s []int
	fmt.Println(s, len(s), cap(s))
	if s == nil {
		fmt.Println("nil!")
	}
}
```

```go
[] 0 0
nil!
```

## 37.ç”¨ make åˆ›å»ºåˆ‡ç‰‡

åˆ‡ç‰‡å¯ä»¥ç”¨å†…ç½®å‡½æ•° `make` æ¥åˆ›å»ºï¼Œè¿™ä¹Ÿæ˜¯ä½ åˆ›å»ºåŠ¨æ€æ•°ç»„çš„æ–¹å¼ã€‚

`make` å‡½æ•°ä¼šåˆ†é…ä¸€ä¸ªå…ƒç´ ä¸ºé›¶å€¼çš„æ•°ç»„å¹¶è¿”å›ä¸€ä¸ªå¼•ç”¨äº†å®ƒçš„åˆ‡ç‰‡ï¼š

```go
a := make([]int, 5)  // len(a)=5
```

è¦æŒ‡å®šå®ƒçš„å®¹é‡ï¼Œéœ€å‘ `make` ä¼ å…¥ç¬¬ä¸‰ä¸ªå‚æ•°ï¼š

```go
b := make([]int, 0, 5) // len(b)=0, cap(b)=5

b = b[:cap(b)] // len(b)=5, cap(b)=5
b = b[1:]      // len(b)=4, cap(b)=4
```

```go
package main

import "fmt"

func main() {
	a := make([]int, 5)
	printSlice("a", a)

	b := make([]int, 0, 5)
	printSlice("b", b)

	c := b[:2]
	printSlice("c", c)

	d := c[2:5]
	printSlice("d", d)
}

func printSlice(s string, x []int) {
	fmt.Printf("%s len=%d cap=%d %v\n",
		s, len(x), cap(x), x)
}
```

```go
a len=5 cap=5 [0 0 0 0 0]
b len=0 cap=5 []
c len=2 cap=5 [0 0]
d len=3 cap=3 [0 0 0]
```

## 38.ä¸¤ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜ï¼šæ•°æ®å®‰å…¨å’Œå†…å­˜æ³„éœ²

å› ä¸º `a`, `c`, `d` å¹¶æ²¡æœ‰å¤åˆ¶æ•°æ®ï¼Œå®ƒä»¬åªæ˜¯åŒä¸€ä¸ªæ•°ç»„çš„ä¸åŒ**çª—å£**ã€‚

**å¦‚æœä½ ä¿®æ”¹äº† `d`ï¼Œ`a` ä¹Ÿä¼šå˜ï¼** è¿™æ‰æ˜¯æœ€å®¹æ˜“å‡º Bug çš„åœ°æ–¹ã€‚

çœ‹çœ‹è¿™ä¸ªä»£ç æ¼”ç¤ºï¼š

```go
func main() {
    // ... å‰é¢çš„ä»£ç ä¸å˜ ...
    // d := c[2:5]  -> d ç°åœ¨æŒ‡å‘åº•å±‚æ•°ç»„çš„ç¬¬3ä¸ªå…ƒç´ 

    // ã€é«˜èƒ½é¢„è­¦ã€‘æˆ‘åªä¿®æ”¹ d
    d[0] = 999 

    // æ‰“å°çœ‹çœ‹ a å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ
    fmt.Println("d:", d) 
    fmt.Println("a:", a)
}
```

**è¾“å‡ºç»“æœï¼š**

```Plaintext
d: [999 0 0]
a: [0 0 999 0 0]  <-- æƒŠä¸æƒŠå–œï¼Ÿa çš„ç¬¬3ä¸ªä½ç½®è¢« d æ”¹æ‰äº†ï¼
```

d[0] çš„å†…å­˜åœ°å€ï¼Œå’Œ a[2] çš„å†…å­˜åœ°å€ï¼Œç‰©ç†ä¸Šæ˜¯åŒä¸€ä¸ªæ ¼å­ã€‚ä½ ä»¥ä¸ºä½ åªæ”¹äº† dï¼Œå®é™…ä¸Šä½ æ”¹äº†åº•å±‚æ•°ç»„ï¼Œæ‰€æœ‰çœ‹ç€è¿™ä¸ªä½ç½®çš„åˆ‡ç‰‡éƒ½ä¼šå˜ã€‚

------

è™½ç„¶ä¸ç”¨æ‰‹åŠ¨åˆ é™¤ï¼Œä½†æœ‰ä¸€ç§æƒ…å†µä¼šå¯¼è‡´**å†…å­˜æµªè´¹**ã€‚

å‡è®¾ä½ è¯»äº†ä¸€ä¸ª **1GB** çš„å¤§æ–‡ä»¶å­˜åˆ° `bigSlice` é‡Œï¼Œç„¶åä½ åªéœ€è¦å¤„ç†å…¶ä¸­ä¸€å°æ®µï¼š

```Go
smallSlice := bigSlice[:10] // åªå–å‰10ä¸ªå­—èŠ‚
return smallSlice           // æŠŠå°åˆ‡ç‰‡ä¼ å‡ºå»ï¼ŒbigSlice æ²¡äººç”¨äº†
```

é—®é¢˜æ¥äº†ï¼š

è™½ç„¶ä½ åªç”¨ 10 ä¸ªå­—èŠ‚ï¼Œä½†å› ä¸º smallSlice å’Œ bigSlice å…±äº«åŒä¸€ä¸ªåº•å±‚æ•°ç»„ã€‚åªè¦ smallSlice è¿˜åœ¨ï¼Œé‚£åŸæœ¬çš„ 1GB å†…å­˜å°±æ­»æ´»ä¸èƒ½è¢«å›æ”¶ï¼ è¿™å°±æ˜¯å…¸å‹çš„å†…å­˜æ³„æ¼ã€‚

è§£å†³æ–¹æ³•ï¼ˆcopyï¼‰ï¼š

å¦‚æœä½ åªéœ€è¦ä¸€å°éƒ¨åˆ†ï¼Œä¸”æƒ³è®©åŸæ¥çš„å¤§æ•°ç»„è¢«å›æ”¶ï¼Œä½ éœ€è¦çœŸçš„å¤åˆ¶ä¸€ä»½æ•°æ®ï¼Œè€Œä¸æ˜¯åˆ‡ç‰‡ã€‚

```Go
// åˆ›å»ºä¸€ä¸ªæ–°çš„ã€ç‹¬ç«‹çš„åˆ‡ç‰‡
realSmall := make([]int, 10)
// æŠŠæ•°æ®æ‹·è¿‡æ¥
copy(realSmall, bigSlice[:10])
// æ­¤æ—¶ bigSlice å¯ä»¥è¢«å›æ”¶äº†ï¼Œå› ä¸º realSmall ç”¨çš„æ˜¯å…¨æ–°çš„å†…å­˜
return realSmall
```

## 39.åˆ‡ç‰‡çš„åˆ‡ç‰‡

åˆ‡ç‰‡å¯ä»¥åŒ…å«ä»»ä½•ç±»å‹ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬å…¶ä»–åˆ‡ç‰‡ã€‚

```go
package main

import (
	"fmt"
	"strings"
)

func main() {
	// åˆ›å»ºä¸€ä¸ªäº•å­—æ£‹ï¼ˆç»å…¸æ¸¸æˆï¼‰
	board := [][]string{
		[]string{"_", "_", "_"},
		[]string{"_", "_", "_"},
		[]string{"_", "_", "_"},
	}

	// ä¸¤ä¸ªç©å®¶è½®æµæ‰“ä¸Š X å’Œ O
	board[0][0] = "X"
	board[2][2] = "O"
	board[1][2] = "X"
	board[1][0] = "O"
	board[0][2] = "X"

	for i := 0; i < len(board); i++ {
		fmt.Printf("%s\n", strings.Join(board[i], " "))
	}
}
```

## 40.å‘åˆ‡ç‰‡è¿½åŠ å…ƒç´ 

ä¸ºåˆ‡ç‰‡è¿½åŠ æ–°çš„å…ƒç´ æ˜¯ç§å¸¸è§çš„æ“ä½œï¼Œä¸ºæ­¤ Go æä¾›äº†å†…ç½®çš„ `append` å‡½æ•°ã€‚å†…ç½®å‡½æ•°çš„[æ–‡æ¡£](https://tour.go-zh.org/pkg/builtin/#append)å¯¹è¯¥å‡½æ•°æœ‰è¯¦ç»†çš„ä»‹ç»ã€‚

```go
func append(s []T, vs ...T) []T
```

`append` çš„ç¬¬ä¸€ä¸ªå‚æ•° `s` æ˜¯ä¸€ä¸ªå…ƒç´ ç±»å‹ä¸º `T` çš„åˆ‡ç‰‡ï¼Œå…¶ä½™ç±»å‹ä¸º `T` çš„å€¼å°†ä¼šè¿½åŠ åˆ°è¯¥åˆ‡ç‰‡çš„æœ«å°¾ã€‚

`append` çš„ç»“æœæ˜¯ä¸€ä¸ªåŒ…å«åŸåˆ‡ç‰‡æ‰€æœ‰å…ƒç´ åŠ ä¸Šæ–°æ·»åŠ å…ƒç´ çš„åˆ‡ç‰‡ã€‚

å½“ `s` çš„åº•å±‚æ•°ç»„å¤ªå°ï¼Œä¸è¶³ä»¥å®¹çº³æ‰€æœ‰ç»™å®šçš„å€¼æ—¶ï¼Œå®ƒå°±ä¼šåˆ†é…ä¸€ä¸ªæ›´å¤§çš„æ•°ç»„ã€‚ è¿”å›çš„åˆ‡ç‰‡ä¼šæŒ‡å‘è¿™ä¸ªæ–°åˆ†é…çš„æ•°ç»„ã€‚

ï¼ˆè¦äº†è§£å…³äºåˆ‡ç‰‡çš„æ›´å¤šå†…å®¹ï¼Œè¯·é˜…è¯»æ–‡ç«  [Go åˆ‡ç‰‡ï¼šç”¨æ³•å’Œæœ¬è´¨](https://tour.go-zh.org/blog/go-slices-usage-and-internals)ã€‚ï¼‰

```go
package main

import "fmt"

func main() {
	var s []int
	printSlice(s)

	// å¯åœ¨ç©ºåˆ‡ç‰‡ä¸Šè¿½åŠ 
	s = append(s, 0)
	printSlice(s)

	// è¿™ä¸ªåˆ‡ç‰‡ä¼šæŒ‰éœ€å¢é•¿
	s = append(s, 1)
	printSlice(s)

	// å¯ä»¥ä¸€æ¬¡æ€§æ·»åŠ å¤šä¸ªå…ƒç´ 
	s = append(s, 2, 3, 4)
	printSlice(s)
}

func printSlice(s []int) {
	fmt.Printf("len=%d cap=%d %v\n", len(s), cap(s), s)
}
```

```go
len=0 cap=0 []
len=1 cap=1 [0]
len=2 cap=2 [0 1]
len=5 cap=5 [0 1 2 3 4]
```

## 41.å†…å­˜å¯¹é½

* **Go ç¡®å®æ¯” Java å’Œ Python æ›´â€œåº•å±‚â€**ã€‚

    - **Java/Python**ï¼šæ˜¯è¿è¡Œåœ¨é‡å‹è™šæ‹Ÿæœºï¼ˆJVM/Interpreterï¼‰ä¸Šçš„ï¼Œå®ƒä»¬å°½åŠ›æŠŠä½ å’Œå†…å­˜éš”ç»å¼€ã€‚å¯¹è±¡å…·ä½“å å¤šå¤§ã€æ€ä¹ˆæ’å¸ƒï¼Œéƒ½æ˜¯è™šæ‹Ÿæœºè¯´äº†ç®—ï¼Œä½ å¾ˆéš¾æ’æ‰‹ã€‚
    - **Go**ï¼šæ›´åƒæ˜¯ä¸€ä¸ª**â€œè‡ªå¸¦åƒåœ¾å›æ”¶çš„ C è¯­è¨€â€**ã€‚å®ƒç›´æ¥ç¼–è¯‘æˆæœºå™¨ç ï¼Œå¹¶ä¸”è¯šå®åœ°æŠŠå†…å­˜å¸ƒå±€æš´éœ²ç»™ä½ ï¼ˆæ¯”å¦‚ `unsafe.Sizeof`ï¼Œæ¯”å¦‚ç»“æ„ä½“å¯¹é½ï¼‰ã€‚

    ä¸ºäº†è®©ä½ èƒ½ç†Ÿç»ƒè¿ç”¨â€œç»“æ„ä½“ç˜¦èº«å¤§æ³•â€ï¼Œè¿™æ˜¯**64ä½æ¶æ„ï¼ˆç°ä»£æœåŠ¡å™¨æ ‡å‡†ç¯å¢ƒï¼‰**ä¸‹çš„å¸¸ç”¨æ•°æ®ç±»å‹å¤§å°æ¸…å•ã€‚

    ä½ å¯ä»¥æŠŠå®ƒä»¬æƒ³è±¡æˆä¿„ç½—æ–¯æ–¹å—çš„å—ï¼Œå†™ç»“æ„ä½“æ—¶ï¼Œå°½é‡**æŠŠå¤§çš„æ–¹å—å¾€ä¸‹æ²‰ï¼ˆæˆ–å¾€ä¸Šæµ®ï¼‰ï¼Œå°çš„å¡«ç¼éš™**ã€‚

    ------

    ### 1. ç¬¬ä¸€æ¢¯é˜Ÿï¼šå¤§å—å¤´ (8 å­—èŠ‚)

    è¿™æ˜¯æœ€å åœ°ç›˜çš„åŸºç¡€ç±»å‹ï¼Œé€šå¸¸æŒ‰ç…§æœºå™¨å­—é•¿å¯¹é½ã€‚

    | **ç±»å‹**              | **å¤§å°**    | **è¯´æ˜**                                                     |
    | --------------------- | ----------- | ------------------------------------------------------------ |
    | **`int64`, `uint64`** | 8 bytes     | ä¹Ÿå°±æ˜¯ long long                                             |
    | **`float64`**         | 8 bytes     | åŒç²¾åº¦æµ®ç‚¹æ•°                                                 |
    | **`complex64`**       | 8 bytes     | å¤æ•°                                                         |
    | **`\*T` (æŒ‡é’ˆ)**      | **8 bytes** | æ‰€æœ‰æŒ‡é’ˆï¼ˆ`*int`, `*User`ï¼‰éƒ½æ˜¯å†…å­˜åœ°å€ï¼Œ64ä½ç³»ç»Ÿä¸‹åœ°å€å°±æ˜¯ 8 å­—èŠ‚ |
    | **`int`, `uint`**     | **8 bytes** | **æ³¨æ„**ï¼šåœ¨ 64 ä½ç³»ç»Ÿä¸Š `int` ç­‰åŒäº `int64`ï¼Œä½†åœ¨ 32 ä½ç³»ç»Ÿä¸Šæ˜¯ 4 å­—èŠ‚ |
    | **`uintptr`**         | 8 bytes     | ç”¨äºå­˜æ”¾æŒ‡é’ˆçš„æ•´æ•°ç±»å‹                                       |

    ### 2. ç¬¬äºŒæ¢¯é˜Ÿï¼šä¸­ç­‰å— (4 å­—èŠ‚)

    | **ç±»å‹**              | **å¤§å°** | **è¯´æ˜**                                     |
    | --------------------- | -------- | -------------------------------------------- |
    | **`int32`, `uint32`** | 4 bytes  | ä¹Ÿå°±æ˜¯å¸¸è§„çš„ int                             |
    | **`float32`**         | 4 bytes  | å•ç²¾åº¦æµ®ç‚¹æ•°                                 |
    | **`rune`**            | 4 bytes  | Go çš„å­—ç¬¦ç±»å‹ï¼Œæœ¬è´¨å°±æ˜¯ `int32` (UTF-8 ç ç‚¹) |

    ### 3. ç¬¬ä¸‰æ¢¯é˜Ÿï¼šå°å— (2 å­—èŠ‚)

    | **ç±»å‹**              | **å¤§å°** | **è¯´æ˜**                               |
    | --------------------- | -------- | -------------------------------------- |
    | **`int16`, `uint16`** | 2 bytes  | å¾ˆå°‘ç”¨ï¼Œé™¤éå¤„ç†ç‰¹å®šç½‘ç»œåè®®æˆ–äºŒè¿›åˆ¶æµ |

    ### 4. ç¬¬å››æ¢¯é˜Ÿï¼šç¢ç‰‡ (1 å­—èŠ‚)

    è¿™æ˜¯ç”¨æ¥â€œå¡«ç¼â€çš„æœ€ä½³ææ–™ã€‚

    | **ç±»å‹**            | **å¤§å°**   | **è¯´æ˜**                                 |
    | ------------------- | ---------- | ---------------------------------------- |
    | **`int8`, `uint8`** | 1 byte     | -128 ~ 127                               |
    | **`byte`**          | 1 byte     | æœ¬è´¨å°±æ˜¯ `uint8`ï¼Œå¸¸ç”¨äºå¤„ç†åŸå§‹æ•°æ®     |
    | **`bool`**          | **1 byte** | æ˜¯çš„ï¼Œå¸ƒå°”å€¼å  1 ä¸ªå­—èŠ‚ï¼Œä¸æ˜¯ 1 ä½ (bit) |

    ------

    ### ğŸš¨ ç‰¹æ®Šæ¢¯é˜Ÿï¼šå¤åˆç±»å‹ï¼ˆåƒä¸‡åˆ«å¿½ç•¥ï¼ï¼‰

    å¾ˆå¤šäººåªè®°å¾— `int`ï¼Œå´å¿˜äº† Go é‡Œæœ€å¸¸ç”¨çš„ `string` å’Œ `slice` å…¶å®ä¹Ÿæ˜¯ç»“æ„ä½“ï¼Œå®ƒä»¬æ¯”ä½ æƒ³è±¡çš„è¦å¤§ï¼

    #### A. å­—ç¬¦ä¸² (`string`)ï¼š16 å­—èŠ‚

    Go çš„ `string` åº•å±‚å…¶å®æ˜¯ä¸€ä¸ªç»“æ„ä½“å¤´ï¼ˆHeaderï¼‰ï¼š

    ```go
    type StringHeader struct {
        Data uintptr // æŒ‡å‘åº•å±‚å­—èŠ‚æ•°ç»„çš„æŒ‡é’ˆ (8 bytes)
        Len  int     // å­—ç¬¦ä¸²é•¿åº¦ (8 bytes)
    }
    ```
    
    **ç»“è®ºï¼š** ä¸€ä¸ª `string` å˜é‡é›·æ‰“ä¸åŠ¨å ç”¨ **16 å­—èŠ‚**ï¼ˆå“ªæ€•å®ƒæ˜¯ç©ºå­—ç¬¦ä¸² `""`ï¼‰ã€‚

    #### B. åˆ‡ç‰‡ (`slice`)ï¼š24 å­—èŠ‚

    è¿™å°±æ˜¯æˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„é‚£ä¸ªâ€œçª—å£â€ï¼š

    ```go
    type SliceHeader struct {
        Data uintptr // æŒ‡é’ˆ (8 bytes)
        Len  int     // é•¿åº¦ (8 bytes)
        Cap  int     // å®¹é‡ (8 bytes)
    }
    ```
    
    **ç»“è®ºï¼š** ä¸€ä¸ª `[]int` å˜é‡å ç”¨ **24 å­—èŠ‚**ã€‚
    
    #### C. æ¥å£ (`interface`)ï¼š16 å­—èŠ‚

    åŒ…å«ä¸¤ä¸ªæŒ‡é’ˆï¼šä¸€ä¸ªæŒ‡å‘ç±»å‹ä¿¡æ¯ï¼Œä¸€ä¸ªæŒ‡å‘å…·ä½“æ•°æ®ã€‚

    - `type pointer` (8 bytes)
    - `data pointer` (8 bytes)
    
    ------
    
    ### âš¡ å®æˆ˜é€Ÿè®°å£è¯€

    å†™ç»“æ„ä½“æ—¶ï¼Œä¸ºäº†èŠ‚çœå†…å­˜ï¼Œåªéœ€éµå¾ª**â€œä»å¤§åˆ°å°â€**çš„åŸåˆ™å£°æ˜å­—æ®µï¼š

    1. **å…ˆæ”¾**ï¼šåˆ‡ç‰‡ (`[]T`)ã€å­—ç¬¦ä¸² (`string`)ã€æŒ‡é’ˆ (`*T`)ã€æ¥å£ (`interface`)ã€`int64`/`float64`ã€‚
        - *(è¿™äº›éƒ½æ˜¯ 8 å­—èŠ‚å¯¹é½çš„å¤§å®¶ä¼™)*
    2. **å†æ”¾**ï¼š`int32`ã€`rune`ã€‚
    3. **æœ€å**ï¼š`bool`ã€`byte`ã€`int8`ã€‚
    
    #### ä¼˜åŒ–æ¡ˆä¾‹ï¼š
    
    ```go
    // âŒ åçš„å†™æ³•ï¼šåƒæ˜¯åœ¨è¿™ä¸€å±‚ä¸€å±‚å¤¹å¿ƒé¥¼å¹²ï¼Œä¸­é—´å…¨æ˜¯ç©ºæ´
    type BadUser struct {
        IsAdmin   bool   // 1 byte (+7 padding) -> 8
        Username  string // 16 bytes
        Age       int32  // 4 bytes (+4 padding) -> 8
        Scores    []int  // 24 bytes
        IsActive  bool   // 1 byte (+7 padding) -> 8
    } 
    // æ€»å…±ï¼š8 + 16 + 8 + 24 + 8 = 64 bytes
    
    // âœ… å¥½çš„å†™æ³•ï¼šå¤§ä¸ªå­ç«™ä¸Šé¢ï¼Œå°ä¸ªå­æŒ¤ä¸‹é¢
    type GoodUser struct {
        Scores    []int  // 24 bytes (8å­—èŠ‚å¯¹é½)
        Username  string // 16 bytes (8å­—èŠ‚å¯¹é½)
        Age       int32  // 4 bytes
        IsAdmin   bool   // 1 byte
        IsActive  bool   // 1 byte
        // è¿™é‡Œåªè¦è¡¥ 2 bytes å°±èƒ½å‡‘é½ 8 bytes (4+1+1+2=8)
    }
    // æ€»å…±ï¼š24 + 16 + 8 = 48 bytes
    ```
    
    **çœæ‰äº† 16 å­—èŠ‚ (25%)ï¼**
    
    ### æ€ä¹ˆè‡ªå·±éªŒè¯ï¼Ÿ
    
    å¦‚æœä¸ç¡®å®šæŸä¸ªç±»å‹å¤šå¤§ï¼Œç›´æ¥ç”¨ `unsafe.Sizeof` æ‰“å°çœ‹ä¸€çœ¼ï¼Œè¿™æ˜¯æœ€æƒå¨çš„ï¼š

    Go

    ```go
    package main
    
    import (
    	"fmt"
    	"unsafe"
    )
    
    func main() {
    	fmt.Println("bool:", unsafe.Sizeof(true))    // 1
    	fmt.Println("int32:", unsafe.Sizeof(int32(0))) // 4
    	fmt.Println("int:", unsafe.Sizeof(int(0)))     // 8 (åœ¨64ä½æœºå™¨ä¸Š)
    	fmt.Println("string:", unsafe.Sizeof("abc"))   // 16
    	fmt.Println("slice:", unsafe.Sizeof([]int{}))  // 24
    }
    ```

---

## 42.range éå†

`for` å¾ªç¯çš„ `range` å½¢å¼å¯éå†åˆ‡ç‰‡æˆ–æ˜ å°„ã€‚

å½“ä½¿ç”¨ `for` å¾ªç¯éå†åˆ‡ç‰‡æ—¶ï¼Œæ¯æ¬¡è¿­ä»£éƒ½ä¼šè¿”å›ä¸¤ä¸ªå€¼ã€‚ ç¬¬ä¸€ä¸ªå€¼ä¸ºå½“å‰å…ƒç´ çš„ä¸‹æ ‡ï¼Œç¬¬äºŒä¸ªå€¼ä¸ºè¯¥ä¸‹æ ‡æ‰€å¯¹åº”å…ƒç´ çš„ä¸€ä»½å‰¯æœ¬ã€‚

```go
package main

import "fmt"

var pow = []int{1, 2, 4, 8, 16, 32, 64, 128}

func main() {
	for i, v := range pow {
		fmt.Printf("2**%d = %d\n", i, v)
	}
}
```

```go
2**0 = 1
2**1 = 2
2**2 = 4
2**3 = 8
2**4 = 16
2**5 = 32
2**6 = 64
2**7 = 128
```

å¯ä»¥å°†ä¸‹æ ‡æˆ–å€¼èµ‹äºˆ `_` æ¥å¿½ç•¥å®ƒã€‚

```go
for i, _ := range pow
for _, value := range pow
```

è‹¥ä½ åªéœ€è¦ç´¢å¼•ï¼Œå¿½ç•¥ç¬¬äºŒä¸ªå˜é‡å³å¯ã€‚

```go
for i := range pow
```

```go
package main

import "fmt"

func main() {
	pow := make([]int, 10)
	for i := range pow {
		pow[i] = 1 << uint(i) // == 2**i
	}
	for _, value := range pow {
		fmt.Printf("%d\n", value)
	}
}
```

## 43.åˆ‡ç‰‡ç»ƒä¹ 

å®ç° `Pic`ã€‚å®ƒåº”å½“è¿”å›ä¸€ä¸ªé•¿åº¦ä¸º `dy` çš„åˆ‡ç‰‡ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º `dx`ï¼Œå…ƒç´ ç±»å‹ä¸º `uint8` çš„åˆ‡ç‰‡ã€‚å½“ä½ è¿è¡Œæ­¤ç¨‹åºæ—¶ï¼Œå®ƒä¼šå°†æ¯ä¸ªæ•´æ•°è§£é‡Šä¸ºç°åº¦å€¼ ï¼ˆå¥½å§ï¼Œå…¶å®æ˜¯è“åº¦å€¼ï¼‰å¹¶æ˜¾ç¤ºå®ƒæ‰€å¯¹åº”çš„å›¾åƒã€‚

å›¾åƒçš„è§£æå¼ç”±ä½ æ¥å®šã€‚å‡ ä¸ªæœ‰è¶£çš„å‡½æ•°åŒ…æ‹¬ `(x+y)/2`ã€`x*y`ã€`x^y`ã€`x*log(y)` å’Œ `x%(y+1)`ã€‚

ï¼ˆæç¤ºï¼šéœ€è¦ä½¿ç”¨å¾ªç¯æ¥åˆ†é… `[][]uint8` ä¸­çš„æ¯ä¸ª `[]uint8`ã€‚ï¼‰

ï¼ˆè¯·ä½¿ç”¨ `uint8(intValue)` åœ¨ç±»å‹ä¹‹é—´è½¬æ¢ï¼›ä½ å¯èƒ½ä¼šç”¨åˆ° `math` åŒ…ä¸­çš„å‡½æ•°ã€‚ï¼‰

```go
package main

import "golang.org/x/tour/pic"

func Pic(dx, dy int) [][]uint8 {
	// 1. åˆ›å»ºå¤–å±‚åˆ‡ç‰‡ï¼ˆç”»å¸ƒçš„â€œè¡Œâ€ï¼‰ï¼Œé•¿åº¦ä¸º dy
	// è¿™é‡Œçš„ result ç±»å‹æ˜¯ [][]uint8
	result := make([][]uint8, dy)

	// 2. éå†æ¯ä¸€è¡Œï¼Œä¸ºæ¯ä¸€è¡Œåˆ†é…å†…å­˜
	for y := 0; y < dy; y++ {
		// ç»™ç¬¬ y è¡Œåˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º dx çš„åˆ‡ç‰‡
		result[y] = make([]uint8, dx)
		
		// 3. éå†è¿™ä¸€è¡Œçš„æ¯ä¸€ä¸ªåƒç´ ï¼ˆåˆ—ï¼‰
		for x := 0; x < dx; x++ {
			// 4. æ ¹æ®åæ ‡ (x, y) è®¡ç®—é¢œè‰²å€¼
			// é¢˜ç›®æ¨èå…¬å¼ä¹‹ä¸€ï¼š(x+y)/2ï¼Œä½ ä¹Ÿå¯ä»¥è¯• x*y æˆ– x^y
			// è®°å¾—ç”¨ uint8() è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢
			value := (x ^ y) / 2
			result[y][x] = uint8(value)
		}
	}

	return result
}

func main() {
	pic.Show(Pic)
}
```

## 44.map æ˜ å°„

`map` æ˜ å°„å°†é”®æ˜ å°„åˆ°å€¼ã€‚

æ˜ å°„çš„é›¶å€¼ä¸º `nil` ã€‚`nil` æ˜ å°„æ—¢æ²¡æœ‰é”®ï¼Œä¹Ÿä¸èƒ½æ·»åŠ é”®ã€‚

`make` å‡½æ•°ä¼šè¿”å›ç»™å®šç±»å‹çš„æ˜ å°„ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–å¤‡ç”¨ã€‚

```go
package main

import "fmt"

type Vertex struct {
	Lat, Long float64
}

var m map[string]Vertex

func main() {
	m = make(map[string]Vertex)
	fmt.Println(m)
	if m == nil {
		fmt.Println("0")
	}
	m["Bell Labs"] = Vertex{
		40.68433, -74.39967,
	}
	fmt.Println(m["Bell Labs"])
}
```

```go
map[]
{40.68433 -74.39967}
```

## 45.æ˜ å°„å­—é¢é‡

æ˜ å°„çš„å­—é¢é‡å’Œç»“æ„ä½“ç±»ä¼¼ï¼Œåªä¸è¿‡å¿…é¡»æœ‰é”®åã€‚

```go
package main

import "fmt"

type Vertex struct {
	Lat, Long float64
}

var m = map[string]Vertex{
	"Bell Labs": Vertex{
		40.68433, -74.39967,
	},
	"Google": Vertex{
		37.42202, -122.08408,
	},
}

func main() {
	fmt.Println(m)
}
```

```go
map[Bell Labs:{40.68433 -74.39967} Google:{37.42202 -122.08408}]
```

è‹¥é¡¶å±‚ç±»å‹åªæ˜¯ä¸€ä¸ªç±»å‹åï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨å­—é¢é‡çš„å…ƒç´ ä¸­çœç•¥å®ƒã€‚

```go
package main

import "fmt"

type Vertex struct {
	Lat, Long float64
}

var m = map[string]Vertex{
	"Bell Labs": {40.68433, -74.39967},
	"Google":    {37.42202, -122.08408},
}

func main() {
	fmt.Println(m)
}
```

## 46.ä¿®æ”¹æ˜ å°„

åœ¨æ˜ å°„ `m` ä¸­æ’å…¥æˆ–ä¿®æ”¹å…ƒç´ ï¼š

```go
m[key] = elem
```

è·å–å…ƒç´ ï¼š

```go
elem = m[key]
```

åˆ é™¤å…ƒç´ ï¼š

```go
delete(m, key)
```

é€šè¿‡åŒèµ‹å€¼æ£€æµ‹æŸä¸ªé”®æ˜¯å¦å­˜åœ¨ï¼š

```go
elem, ok = m[key]
```

è‹¥ `key` åœ¨ `m` ä¸­ï¼Œ`ok` ä¸º `true` ï¼›å¦åˆ™ï¼Œ`ok` ä¸º `false`ã€‚

è‹¥ `key` ä¸åœ¨æ˜ å°„ä¸­ï¼Œåˆ™ `elem` æ˜¯è¯¥æ˜ å°„å…ƒç´ ç±»å‹çš„é›¶å€¼ã€‚

**æ³¨**ï¼šè‹¥ `elem` æˆ– `ok` è¿˜æœªå£°æ˜ï¼Œä½ å¯ä»¥ä½¿ç”¨çŸ­å˜é‡å£°æ˜ï¼š

```go
elem, ok := m[key]
```

```go
å€¼ï¼š 42
å€¼ï¼š 48
å€¼ï¼š 0
å€¼ï¼š 0 æ˜¯å¦å­˜åœ¨ï¼Ÿ false
```

## 47.æ˜ å°„ç»ƒä¹ 

å®ç° `WordCount`ã€‚å®ƒåº”å½“è¿”å›ä¸€ä¸ªæ˜ å°„ï¼Œå…¶ä¸­åŒ…å«å­—ç¬¦ä¸² `s` ä¸­æ¯ä¸ªâ€œå•è¯â€çš„ä¸ªæ•°ã€‚ å‡½æ•° `wc.Test` ä¼šä¸ºæ­¤å‡½æ•°æ‰§è¡Œä¸€ç³»åˆ—æµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶è¾“å‡ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ã€‚

ä½ ä¼šå‘ç° [strings.Fields](https://go-zh.org/pkg/strings/#Fields) å¾ˆæœ‰ç”¨ã€‚

```go
package main

import (
	"strings" // ç¬¬ä¸€æ­¥ï¼šä¸€å®šè¦è®°å¾—å¼•å…¥è¿™ä¸ªåŒ…ï¼
	"golang.org/x/tour/wc"
)

func WordCount(s string) map[string]int {
	// 1. æ‹†åˆ†å­—ç¬¦ä¸²
	// strings.Fields ä¼šå¸®ä½ å»æ‰æ‰€æœ‰çš„ç©ºæ ¼ï¼ŒæŠŠå•è¯æå–å‡ºæ¥æ”¾åˆ°åˆ‡ç‰‡é‡Œ
	words := strings.Fields(s)

	// 2. åˆ›å»ºä¸€ä¸ªç©ºçš„ mapï¼ˆè®°è´¦æœ¬ï¼‰
	// key æ˜¯ string (å•è¯)ï¼Œvalue æ˜¯ int (æ¬¡æ•°)
	result := make(map[string]int)

	// 3. éå†æ¯ä¸€ä¸ªå•è¯
	for _, word := range words {
		// 4. æ ¸å¿ƒé€»è¾‘ï¼šè®¡æ•°
		// Go è¯­è¨€çš„ map æœ‰ä¸ªå¾ˆæ£’çš„ç‰¹æ€§ï¼š
		// å¦‚æœ word åœ¨ map é‡Œä¸å­˜åœ¨ï¼Œresult[word] é»˜è®¤å°±æ˜¯ 0ã€‚
		// æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥å†™ ++ï¼Œä¸ç”¨åˆ¤æ–­å®ƒæ˜¯å¦å­˜åœ¨ã€‚
		result[word]++
	}

	return result
}

func main() {
	wc.Test(WordCount)
}
```

```go
PASS
 f("I am learning Go!") = 
  map[string]int{"Go!":1, "I":1, "am":1, "learning":1}
PASS
 f("The quick brown fox jumped over the lazy dog.") = 
  map[string]int{"The":1, "brown":1, "dog.":1, "fox":1, "jumped":1, "lazy":1, "over":1, "quick":1, "the":1}
PASS
 f("I ate a donut. Then I ate another donut.") = 
  map[string]int{"I":2, "Then":1, "a":1, "another":1, "ate":2, "donut.":2}
PASS
 f("A man a plan a canal panama.") = 
  map[string]int{"A":1, "a":2, "canal":1, "man":1, "panama.":1, "plan":1}
```

## 48.å‡½æ•°å€¼

å‡½æ•°ä¹Ÿæ˜¯å€¼ã€‚å®ƒä»¬å¯ä»¥åƒå…¶ä»–å€¼ä¸€æ ·ä¼ é€’ã€‚

å‡½æ•°å€¼å¯ä»¥ç”¨ä½œå‡½æ•°çš„å‚æ•°æˆ–è¿”å›å€¼ã€‚

```go
package main

import (
	"fmt"
	"math"
)

func compute(fn func(float64, float64) float64) float64 {
	return fn(3, 4)
}

func main() {
	hypot := func(x, y float64) float64 {
		return math.Sqrt(x*x + y*y)
	}
	fmt.Println(hypot(5, 12))

	fmt.Println(compute(hypot))
	fmt.Println(compute(math.Pow))
}
```

```go
13
5
81
```

## 49.å‡½æ•°é—­åŒ…

Go å‡½æ•°å¯ä»¥æ˜¯ä¸€ä¸ªé—­åŒ…ã€‚é—­åŒ…æ˜¯ä¸€ä¸ªå‡½æ•°å€¼ï¼Œå®ƒå¼•ç”¨äº†å…¶å‡½æ•°ä½“ä¹‹å¤–çš„å˜é‡ã€‚ è¯¥å‡½æ•°å¯ä»¥è®¿é—®å¹¶èµ‹äºˆå…¶å¼•ç”¨çš„å˜é‡å€¼ï¼Œæ¢å¥è¯è¯´ï¼Œè¯¥å‡½æ•°è¢«â€œç»‘å®šâ€åˆ°äº†è¿™äº›å˜é‡ã€‚

ä¾‹å¦‚ï¼Œå‡½æ•° `adder` è¿”å›ä¸€ä¸ªé—­åŒ…ã€‚æ¯ä¸ªé—­åŒ…éƒ½è¢«ç»‘å®šåœ¨å…¶å„è‡ªçš„ `sum` å˜é‡ä¸Šã€‚

```go
package main

import "fmt"

func adder() func(int) int {
	sum := 0
	return func(x int) int {
		sum += x
		return sum
	}
}

func main() {
	pos, neg := adder(), adder()
	for i := 0; i < 10; i++ {
		fmt.Println(
			pos(i),
			neg(-2*i),
		)
	}
}
```

```go
0 0
1 -2
3 -6
6 -12
10 -20
15 -30
21 -42
28 -56
36 -72
45 -90
```

é—­åŒ…åˆ°åº•æœ‰ä»€ä¹ˆç”¨ï¼Ÿ å®ƒå…è®¸ä½ åˆ›å»º**â€œæœ‰çŠ¶æ€çš„å‡½æ•°â€**ã€‚ ä½ ä¸éœ€è¦åˆ›å»ºä¸€ä¸ªå…¨å±€å˜é‡ï¼ˆé‚£æ ·è°éƒ½èƒ½æ”¹ï¼Œä¸å®‰å…¨ï¼‰ï¼Œä¹Ÿä¸éœ€è¦ä¸“é—¨å†™ä¸€ä¸ªå¤æ‚çš„ç»“æ„ä½“ã€‚ä½ åªéœ€è¦ç”¨é—­åŒ…ï¼Œå°±èƒ½è®©ä¸€ä¸ªå‡½æ•°æ‹¥æœ‰è‡ªå·±**ç§æœ‰çš„ã€æŒä¹…çš„è®°å¿†**ã€‚

## 50.ç»ƒä¹ ï¼šæ–æ³¢çº³å¥‘é—­åŒ…

è®©æˆ‘ä»¬ç”¨å‡½æ•°åšäº›å¥½ç©çš„ã€‚

å®ç°ä¸€ä¸ª `fibonacci` å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªå‡½æ•°ï¼ˆé—­åŒ…ï¼‰ï¼Œè¯¥é—­åŒ…è¿”å›ä¸€ä¸ª[æ–æ³¢çº³å¥‘æ•°åˆ—](https://zh.wikipedia.org/wiki/æ–æ³¢é‚£å¥‘æ•°åˆ—) (0, 1, 1, 2, 3, 5, ...)ã€‚

```go
package main

import "fmt"

// fibonacci æ˜¯è¿”å›ä¸€ä¸ªã€Œè¿”å›ä¸€ä¸ª int çš„å‡½æ•°ã€çš„å‡½æ•°
func fibonacci() func() int {
    last := 0
	llast := 0
	time := 0
	return func() int{
		if time == 0{
			time += 1
			return last
		}else if time == 1 {
			time += 1
			llast = 0
			last = 1
			return last
		}else{
			time+=1
			tmp := llast
			llast = last
			last = last + tmp
			return last
		}
	}
}

func main() {
	f := fibonacci()
	for i := 0; i < 10; i++ {
		fmt.Println(f())
	}
}
```

or

```go
package main

import "fmt"

// fibonacci è¿”å›ä¸€ä¸ªé—­åŒ…ï¼Œæ¯æ¬¡è°ƒç”¨è¿”å›ä¸‹ä¸€ä¸ªæ–æ³¢çº³å¥‘æ•°
func fibonacci() func() int {
	// åˆå§‹åŒ–ä¸¤ä¸ªå˜é‡ï¼Œåˆ†åˆ«ä»£è¡¨â€œå½“å‰å€¼â€å’Œâ€œä¸‹ä¸€ä¸ªå€¼â€
	// åºåˆ—åˆå§‹çŠ¶æ€ï¼š0, 1
	back1, back2 := 0, 1

	return func() int {
		// 1. è®°å½•æˆ‘ä»¬è¦è¿”å›çš„å½“å‰å€¼
		ret := back1

		// 2. æ›´æ–°çŠ¶æ€ï¼Œå‡†å¤‡ä¸‹ä¸€æ¬¡è°ƒç”¨
		// è¿™ä¸€è¡Œæ˜¯ç²¾é«“ï¼šGo æ”¯æŒâ€œå¤šé‡èµ‹å€¼â€ï¼ŒåŒæ—¶è®¡ç®—å³è¾¹ï¼Œå†èµ‹ç»™å·¦è¾¹
		// æ–°çš„ back1 å˜æˆæ—§çš„ back2
		// æ–°çš„ back2 å˜æˆæ—§çš„ back1 + back2
		back1, back2 = back2, back1+back2

		// 3. è¿”å›è®°å½•çš„å€¼
		return ret
	}
}

func main() {
	f := fibonacci()
	for i := 0; i < 10; i++ {
		fmt.Println(f())
	}
}
```

## 51.æ–¹æ³•

Go æ²¡æœ‰ç±»ã€‚ä¸è¿‡ä½ å¯ä»¥ä¸ºç±»å‹å®šä¹‰æ–¹æ³•ã€‚

æ–¹æ³•å°±æ˜¯ä¸€ç±»å¸¦ç‰¹æ®Šçš„ **æ¥æ”¶è€…** å‚æ•°çš„å‡½æ•°ã€‚

æ–¹æ³•æ¥æ”¶è€…åœ¨å®ƒè‡ªå·±çš„å‚æ•°åˆ—è¡¨å†…ï¼Œä½äº `func` å…³é”®å­—å’Œæ–¹æ³•åä¹‹é—´ã€‚

åœ¨æ­¤ä¾‹ä¸­ï¼Œ`Abs` æ–¹æ³•æ‹¥æœ‰ä¸€ä¸ªåå­—ä¸º `v`ï¼Œç±»å‹ä¸º `Vertex` çš„æ¥æ”¶è€…ã€‚

```go
package main

import (
	"fmt"
	"math"
)

type Vertex struct {
	X, Y float64
}

func (v Vertex) Abs() float64 {
	return math.Sqrt(v.X*v.X + v.Y*v.Y)
}

func main() {
	v := Vertex{3, 4}
	fmt.Println(v.Abs())
}
```

## 52.æ–¹æ³•å³å‡½æ•°

è®°ä½ï¼šæ–¹æ³•åªæ˜¯ä¸ªå¸¦æ¥æ”¶è€…å‚æ•°çš„å‡½æ•°ã€‚

ç°åœ¨è¿™ä¸ª `Abs` çš„å†™æ³•å°±æ˜¯ä¸ªæ­£å¸¸çš„å‡½æ•°ï¼ŒåŠŸèƒ½å¹¶æ²¡æœ‰ä»€ä¹ˆå˜åŒ–ã€‚

```go
package main

import (
	"fmt"
	"math"
)

type Vertex struct {
	X, Y float64
}

func Abs(v Vertex) float64 {
	return math.Sqrt(v.X*v.X + v.Y*v.Y)
}

func main() {
	v := Vertex{3, 4}
	fmt.Println(Abs(v))
}
```

## 53.æ–¹æ³•ï¼ˆç»­ï¼‰

ä½ ä¹Ÿå¯ä»¥ä¸ºéç»“æ„ä½“ç±»å‹å£°æ˜æ–¹æ³•ã€‚

åœ¨æ­¤ä¾‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªå¸¦ `Abs` æ–¹æ³•çš„æ•°å€¼ç±»å‹ `MyFloat`ã€‚

ä½ åªèƒ½ä¸ºåœ¨åŒä¸€ä¸ªåŒ…ä¸­å®šä¹‰çš„æ¥æ”¶è€…ç±»å‹å£°æ˜æ–¹æ³•ï¼Œè€Œä¸èƒ½ä¸ºå…¶å®ƒåˆ«çš„åŒ…ä¸­å®šä¹‰çš„ç±»å‹ ï¼ˆåŒ…æ‹¬ `int` ä¹‹ç±»çš„å†…ç½®ç±»å‹ï¼‰å£°æ˜æ–¹æ³•ã€‚

ï¼ˆè¯‘æ³¨ï¼šå°±æ˜¯æ¥æ”¶è€…çš„ç±»å‹å®šä¹‰å’Œæ–¹æ³•å£°æ˜å¿…é¡»åœ¨åŒä¸€åŒ…å†…ã€‚ï¼‰

```go
package main

import (
	"fmt"
	"math"
)

type MyFloat float64

func (f MyFloat) Abs() float64 {
	if f < 0 {
		return float64(-f)
	}
	return float64(f)
}

func main() {
	f := MyFloat(-math.Sqrt2)
	fmt.Println(f.Abs())
}

```

## 54.æŒ‡é’ˆç±»å‹çš„æ¥æ”¶è€…

ä½ å¯ä»¥ä¸ºæŒ‡é’ˆç±»å‹çš„æ¥æ”¶è€…å£°æ˜æ–¹æ³•ã€‚

è¿™æ„å‘³ç€å¯¹äºæŸç±»å‹ `T`ï¼Œæ¥æ”¶è€…çš„ç±»å‹å¯ä»¥ç”¨ `*T` çš„æ–‡æ³•ã€‚ ï¼ˆæ­¤å¤–ï¼Œ`T` æœ¬èº«ä¸èƒ½æ˜¯æŒ‡é’ˆï¼Œæ¯”å¦‚ä¸èƒ½æ˜¯ `*int`ã€‚ï¼‰

ä¾‹å¦‚ï¼Œè¿™é‡Œä¸º `*Vertex` å®šä¹‰äº† `Scale` æ–¹æ³•ã€‚

æŒ‡é’ˆæ¥æ”¶è€…çš„æ–¹æ³•å¯ä»¥ä¿®æ”¹æ¥æ”¶è€…æŒ‡å‘çš„å€¼ï¼ˆå¦‚è¿™é‡Œçš„ `Scale` æ‰€ç¤ºï¼‰ã€‚ ç”±äºæ–¹æ³•ç»å¸¸éœ€è¦ä¿®æ”¹å®ƒçš„æ¥æ”¶è€…ï¼ŒæŒ‡é’ˆæ¥æ”¶è€…æ¯”å€¼æ¥æ”¶è€…æ›´å¸¸ç”¨ã€‚

è¯•ç€ç§»é™¤ç¬¬ 16 è¡Œ `Scale` å‡½æ•°å£°æ˜ä¸­çš„ `*`ï¼Œè§‚å¯Ÿæ­¤ç¨‹åºçš„è¡Œä¸ºå¦‚ä½•å˜åŒ–ã€‚

è‹¥ä½¿ç”¨å€¼æ¥æ”¶è€…ï¼Œé‚£ä¹ˆ `Scale` æ–¹æ³•ä¼šå¯¹åŸå§‹ `Vertex` å€¼çš„å‰¯æœ¬è¿›è¡Œæ“ä½œã€‚ï¼ˆå¯¹äºå‡½æ•°çš„å…¶å®ƒå‚æ•°ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ï¼‰`Scale` æ–¹æ³•å¿…é¡»ç”¨æŒ‡é’ˆæ¥æ”¶è€…æ¥æ›´æ”¹ `main` å‡½æ•°ä¸­å£°æ˜çš„ `Vertex` çš„å€¼ã€‚

```go
package main

import (
	"fmt"
	"math"
)

type Vertex struct {
	X, Y float64
}

func (v Vertex) Abs() float64 {
	return math.Sqrt(v.X*v.X + v.Y*v.Y)
}

func (v *Vertex) Scale(f float64) {
	v.X = v.X * f
	v.Y = v.Y * f
}

func main() {
	v := Vertex{3, 4}
	v.Scale(10)
	fmt.Println(v.Abs())
}
```

## 55.æ–¹æ³•ä¸æŒ‡é’ˆé‡å®šå‘

ä½ å¤§æ¦‚ä¼šæ³¨æ„åˆ°å¸¦æŒ‡é’ˆå‚æ•°çš„å‡½æ•°å¿…é¡»æ¥å—ä¸€ä¸ªæŒ‡é’ˆï¼š

```go
var v Vertex
ScaleFunc(v, 5)  // ç¼–è¯‘é”™è¯¯ï¼
ScaleFunc(&v, 5) // OK
```

è€Œæ¥æ”¶è€…ä¸ºæŒ‡é’ˆçš„çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œæ¥æ”¶è€…æ—¢èƒ½æ˜¯å€¼åˆèƒ½æ˜¯æŒ‡é’ˆï¼š

```go
var v Vertex
v.Scale(5)  // OK
p := &v
p.Scale(10) // OK
```

å¯¹äºè¯­å¥ `v.Scale(5)` æ¥è¯´ï¼Œå³ä¾¿ `v` æ˜¯ä¸€ä¸ªå€¼è€ŒéæŒ‡é’ˆï¼Œå¸¦æŒ‡é’ˆæ¥æ”¶è€…çš„æ–¹æ³•ä¹Ÿèƒ½è¢«ç›´æ¥è°ƒç”¨ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œç”±äº `Scale` æ–¹æ³•æœ‰ä¸€ä¸ªæŒ‡é’ˆæ¥æ”¶è€…ï¼Œä¸ºæ–¹ä¾¿èµ·è§ï¼ŒGo ä¼šå°†è¯­å¥ `v.Scale(5)` è§£é‡Šä¸º `(&v).Scale(5)`ã€‚

```go
package main

import "fmt"

type Vertex struct {
	X, Y float64
}

func (v *Vertex) Scale(f float64) {
	v.X = v.X * f
	v.Y = v.Y * f
}

func ScaleFunc(v *Vertex, f float64) {
	v.X = v.X * f
	v.Y = v.Y * f
}

func main() {
	v := Vertex{3, 4}
	v.Scale(2)
	ScaleFunc(&v, 10)

	p := &Vertex{4, 3}
	p.Scale(3)
	ScaleFunc(p, 8)

	fmt.Println(v, p)
}
```

```go
{60 80} &{96 72}
```

## 56.æ–¹æ³•ä¸æŒ‡é’ˆé‡å®šå‘ï¼ˆç»­ï¼‰

åä¹‹ä¹Ÿä¸€æ ·ï¼š

æ¥å—ä¸€ä¸ªå€¼ä½œä¸ºå‚æ•°çš„å‡½æ•°å¿…é¡»æ¥å—ä¸€ä¸ªæŒ‡å®šç±»å‹çš„å€¼ï¼š

```go
var v Vertex
fmt.Println(AbsFunc(v))  // OK
fmt.Println(AbsFunc(&v)) // ç¼–è¯‘é”™è¯¯ï¼
```

è€Œä»¥å€¼ä¸ºæ¥æ”¶è€…çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œæ¥æ”¶è€…æ—¢èƒ½ä¸ºå€¼åˆèƒ½ä¸ºæŒ‡é’ˆï¼š

```go
var v Vertex
fmt.Println(v.Abs()) // OK
p := &v
fmt.Println(p.Abs()) // OK
```

è¿™ç§æƒ…å†µä¸‹ï¼Œæ–¹æ³•è°ƒç”¨ `p.Abs()` ä¼šè¢«è§£é‡Šä¸º `(*p).Abs()`ã€‚

```go
package main

import (
	"fmt"
	"math"
)

type Vertex struct {
	X, Y float64
}

func (v Vertex) Abs() float64 {
	return math.Sqrt(v.X*v.X + v.Y*v.Y)
}

func AbsFunc(v Vertex) float64 {
	return math.Sqrt(v.X*v.X + v.Y*v.Y)
}

func main() {
	v := Vertex{3, 4}
	fmt.Println(v.Abs())
	fmt.Println(AbsFunc(v))

	p := &Vertex{4, 3}
	fmt.Println(p.Abs())
	fmt.Println(AbsFunc(*p))
}
```

```go
5
5
5
5
```

## 57.é€‰æ‹©å€¼æˆ–æŒ‡é’ˆä½œä¸ºæ¥æ”¶è€…

ä½¿ç”¨æŒ‡é’ˆæ¥æ”¶è€…çš„åŸå› æœ‰äºŒï¼š

é¦–å…ˆï¼Œæ–¹æ³•èƒ½å¤Ÿä¿®æ”¹å…¶æ¥æ”¶è€…æŒ‡å‘çš„å€¼ã€‚

å…¶æ¬¡ï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨æ¯æ¬¡è°ƒç”¨æ–¹æ³•æ—¶å¤åˆ¶è¯¥å€¼ã€‚è‹¥å€¼çš„ç±»å‹ä¸ºå¤§å‹ç»“æ„ä½“æ—¶ï¼Œè¿™æ ·ä¼šæ›´åŠ é«˜æ•ˆã€‚

åœ¨æœ¬ä¾‹ä¸­ï¼Œ`Scale` å’Œ `Abs` æ¥æ”¶è€…çš„ç±»å‹ä¸º `*Vertex`ï¼Œå³ä¾¿ `Abs` å¹¶ä¸éœ€è¦ä¿®æ”¹å…¶æ¥æ”¶è€…ã€‚

é€šå¸¸æ¥è¯´ï¼Œæ‰€æœ‰ç»™å®šç±»å‹çš„æ–¹æ³•éƒ½åº”è¯¥æœ‰å€¼æˆ–æŒ‡é’ˆæ¥æ”¶è€…ï¼Œä½†å¹¶ä¸åº”è¯¥äºŒè€…æ··ç”¨ã€‚ ï¼ˆæˆ‘ä»¬ä¼šåœ¨æ¥ä¸‹æ¥å‡ é¡µä¸­æ˜ç™½ä¸ºä»€ä¹ˆã€‚ï¼‰

```go
package main

import (
	"fmt"
	"math"
)

type Vertex struct {
	X, Y float64
}

func (v *Vertex) Scale(f float64) {
	v.X = v.X * f
	v.Y = v.Y * f
}

func (v *Vertex) Abs() float64 {
	return math.Sqrt(v.X*v.X + v.Y*v.Y)
}

func main() {
	v := &Vertex{3, 4}
	fmt.Printf("ç¼©æ”¾å‰ï¼š%+vï¼Œç»å¯¹å€¼ï¼š%v\n", v, v.Abs())
	v.Scale(5)
	fmt.Printf("ç¼©æ”¾åï¼š%+vï¼Œç»å¯¹å€¼ï¼š%v\n", v, v.Abs())
}
```

```go
ç¼©æ”¾å‰ï¼š&{X:3 Y:4}ï¼Œç»å¯¹å€¼ï¼š5
ç¼©æ”¾åï¼š&{X:15 Y:20}ï¼Œç»å¯¹å€¼ï¼š25
```

## 58.æ¥å£

**æ¥å£ç±»å‹** çš„å®šä¹‰ä¸ºä¸€ç»„æ–¹æ³•ç­¾åã€‚

æ¥å£ç±»å‹çš„å˜é‡å¯ä»¥æŒæœ‰ä»»ä½•å®ç°äº†è¿™äº›æ–¹æ³•çš„å€¼ã€‚

**æ³¨æ„:** ç¤ºä¾‹ä»£ç çš„ç¬¬ 22 è¡Œå­˜åœ¨ä¸€ä¸ªé”™è¯¯ã€‚ç”±äº `Abs` æ–¹æ³•åªä¸º `*Vertex` ï¼ˆæŒ‡é’ˆç±»å‹ï¼‰å®šä¹‰ï¼Œå› æ­¤ `Vertex`ï¼ˆå€¼ç±»å‹ï¼‰å¹¶æœªå®ç° `Abser`ã€‚

```go
package main

import (
	"fmt"
	"math"
)

type Abser interface {
	Abs() float64
}

func main() {
	var a Abser
	f := MyFloat(-math.Sqrt2)
	v := Vertex{3, 4}

	a = f  // a MyFloat å®ç°äº† Abser
	a = &v // a *Vertex å®ç°äº† Abser

	// ä¸‹é¢ä¸€è¡Œï¼Œv æ˜¯ä¸€ä¸ª Vertexï¼ˆè€Œä¸æ˜¯ *Vertexï¼‰
	// æ‰€ä»¥æ²¡æœ‰å®ç° Abserã€‚
	a = v

	fmt.Println(a.Abs())
}

type MyFloat float64

func (f MyFloat) Abs() float64 {
	if f < 0 {
		return float64(-f)
	}
	return float64(f)
}

type Vertex struct {
	X, Y float64
}

func (v *Vertex) Abs() float64 {
	return math.Sqrt(v.X*v.X + v.Y*v.Y)
}
```

```go
./prog.go:22:6: cannot use v (variable of struct type Vertex) as Abser value in assignment: Vertex does not implement Abser (method Abs has pointer receiver)
```

## 59.æ¥å£ä¸éšå¼å®ç°

ç±»å‹é€šè¿‡å®ç°ä¸€ä¸ªæ¥å£çš„æ‰€æœ‰æ–¹æ³•æ¥å®ç°è¯¥æ¥å£ã€‚æ—¢ç„¶æ— éœ€ä¸“é—¨æ˜¾å¼å£°æ˜ï¼Œä¹Ÿå°±æ²¡æœ‰â€œimplementsâ€å…³é”®å­—ã€‚

éšå¼æ¥å£ä»æ¥å£çš„å®ç°ä¸­è§£è€¦äº†å®šä¹‰ï¼Œè¿™æ ·æ¥å£çš„å®ç°å¯ä»¥å‡ºç°åœ¨ä»»ä½•åŒ…ä¸­ï¼Œæ— éœ€æå‰å‡†å¤‡ã€‚

å› æ­¤ï¼Œä¹Ÿå°±æ— éœ€åœ¨æ¯ä¸€ä¸ªå®ç°ä¸Šå¢åŠ æ–°çš„æ¥å£åç§°ï¼Œè¿™æ ·åŒæ—¶ä¹Ÿé¼“åŠ±äº†æ˜ç¡®çš„æ¥å£å®šä¹‰ã€‚

```go
package main

import "fmt"

type I interface {
	M()
}

type T struct {
	S string
}

// æ­¤æ–¹æ³•è¡¨ç¤ºç±»å‹ T å®ç°äº†æ¥å£ Iï¼Œä¸è¿‡æˆ‘ä»¬å¹¶ä¸éœ€è¦æ˜¾å¼å£°æ˜è¿™ä¸€ç‚¹ã€‚
func (t T) M() {
	fmt.Println(t.S)
}

func main() {
	var i I = T{"hello"}
	i.M()
}
```

## 60.æ¥å£å€¼

æ¥å£ä¹Ÿæ˜¯å€¼ã€‚å®ƒä»¬å¯ä»¥åƒå…¶å®ƒå€¼ä¸€æ ·ä¼ é€’ã€‚

æ¥å£å€¼å¯ä»¥ç”¨ä½œå‡½æ•°çš„å‚æ•°æˆ–è¿”å›å€¼ã€‚

åœ¨å†…éƒ¨ï¼Œæ¥å£å€¼å¯ä»¥çœ‹åšåŒ…å«å€¼å’Œå…·ä½“ç±»å‹çš„å…ƒç»„ï¼š

```go
(value, type)
```

æ¥å£å€¼ä¿å­˜äº†ä¸€ä¸ªå…·ä½“åº•å±‚ç±»å‹çš„å…·ä½“å€¼ã€‚

æ¥å£å€¼è°ƒç”¨æ–¹æ³•æ—¶ä¼šæ‰§è¡Œå…¶åº•å±‚ç±»å‹çš„åŒåæ–¹æ³•ã€‚

```go
package main

import (
	"fmt"
	"math"
)

type I interface {
	M()
}

type T struct {
	S string
}

func (t *T) M() {
	fmt.Println(t.S)
}

type F float64

func (f F) M() {
	fmt.Println(f)
}

func main() {
	var i I

	i = &T{"Hello"}
	describe(i)
	i.M()

	i = F(math.Pi)
	describe(i)
	i.M()
}

func describe(i I) {
	fmt.Printf("(%v, %T)\n", i, i)
}

// (&{Hello}, *main.T)
// Hello
// (3.141592653589793, main.F)
// 3.141592653589793
```

## 61.åº•å±‚å€¼ä¸º nil çš„æ¥å£å€¼

å³ä¾¿æ¥å£å†…çš„å…·ä½“å€¼ä¸º nilï¼Œæ–¹æ³•ä»ç„¶ä¼šè¢« nil æ¥æ”¶è€…è°ƒç”¨ã€‚

åœ¨ä¸€äº›è¯­è¨€ä¸­ï¼Œè¿™ä¼šè§¦å‘ä¸€ä¸ªç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œä½†åœ¨ Go ä¸­é€šå¸¸ä¼šå†™ä¸€äº›æ–¹æ³•æ¥ä¼˜é›…åœ°å¤„ç†å®ƒï¼ˆå¦‚æœ¬ä¾‹ä¸­çš„ `M` æ–¹æ³•ï¼‰ã€‚

**æ³¨æ„:** ä¿å­˜äº† nil å…·ä½“å€¼çš„æ¥å£å…¶è‡ªèº«å¹¶ä¸ä¸º nilã€‚

```go
package main

import "fmt"

type I interface {
	M()
}

type T struct {
	S string
}

func (t *T) M() {
	if t == nil {
		fmt.Println("<nil>")
		return
	}
	fmt.Println(t.S)
}

func main() {
	var i I

	var t *T
	i = t
	describe(i)
	i.M()

	i = &T{"hello"}
	describe(i)
	i.M()
}

func describe(i I) {
	fmt.Printf("(%v, %T)\n", i, i)
}
```

```go
(<nil>, *main.T)
<nil>
(&{hello}, *main.T)
hello
```

## 62.nil æ¥å£å€¼

nil æ¥å£å€¼æ—¢ä¸ä¿å­˜å€¼ä¹Ÿä¸ä¿å­˜å…·ä½“ç±»å‹ã€‚

ä¸º nil æ¥å£è°ƒç”¨æ–¹æ³•ä¼šäº§ç”Ÿè¿è¡Œæ—¶é”™è¯¯ï¼Œå› ä¸ºæ¥å£çš„å…ƒç»„å†…å¹¶æœªåŒ…å«èƒ½å¤ŸæŒ‡æ˜è¯¥è°ƒç”¨å“ªä¸ª **å…·ä½“** æ–¹æ³•çš„ç±»å‹ã€‚

```go
package main

import "fmt"

type I interface {
	M()
}

func main() {
	var i I
	describe(i)
	i.M()
}

func describe(i I) {
	fmt.Printf("(%v, %T)\n", i, i)
}
```

```go
(<nil>, <nil>)
panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x4992b9]

goroutine 1 [running]:
main.main()
	/tmp/sandbox3042555577/prog.go:12 +0x19
```

## 63.ç©ºæ¥å£

æŒ‡å®šäº†é›¶ä¸ªæ–¹æ³•çš„æ¥å£å€¼è¢«ç§°ä¸º *ç©ºæ¥å£ï¼š*

```go
interface{}
```

ç©ºæ¥å£å¯ä¿å­˜ä»»ä½•ç±»å‹çš„å€¼ã€‚ï¼ˆå› ä¸ºæ¯ä¸ªç±»å‹éƒ½è‡³å°‘å®ç°äº†é›¶ä¸ªæ–¹æ³•ã€‚ï¼‰

ç©ºæ¥å£è¢«ç”¨æ¥å¤„ç†æœªçŸ¥ç±»å‹çš„å€¼ã€‚ä¾‹å¦‚ï¼Œ`fmt.Print` å¯æ¥å—ç±»å‹ä¸º `interface{}` çš„ä»»æ„æ•°é‡çš„å‚æ•°ã€‚

```go
package main

import "fmt"

func main() {
	var i interface{}
	describe(i)

	i = 42
	describe(i)

	i = "hello"
	describe(i)
}

func describe(i interface{}) {
	fmt.Printf("(%v, %T)\n", i, i)
}
```

```go
(<nil>, <nil>)
(42, int)
(hello, string)
```

## 64.ç±»å‹æ–­è¨€

**ç±»å‹æ–­è¨€** æä¾›äº†è®¿é—®æ¥å£å€¼åº•å±‚å…·ä½“å€¼çš„æ–¹å¼ã€‚

```go
t := i.(T)
```

è¯¥è¯­å¥æ–­è¨€æ¥å£å€¼ `i` ä¿å­˜äº†å…·ä½“ç±»å‹ `T`ï¼Œå¹¶å°†å…¶åº•å±‚ç±»å‹ä¸º `T` çš„å€¼èµ‹äºˆå˜é‡ `t`ã€‚

è‹¥ `i` å¹¶æœªä¿å­˜ `T` ç±»å‹çš„å€¼ï¼Œè¯¥è¯­å¥å°±ä¼šè§¦å‘ä¸€ä¸ª panicã€‚

ä¸ºäº† **åˆ¤æ–­** ä¸€ä¸ªæ¥å£å€¼æ˜¯å¦ä¿å­˜äº†ä¸€ä¸ªç‰¹å®šçš„ç±»å‹ï¼Œç±»å‹æ–­è¨€å¯è¿”å›ä¸¤ä¸ªå€¼ï¼šå…¶åº•å±‚å€¼ä»¥åŠä¸€ä¸ªæŠ¥å‘Šæ–­è¨€æ˜¯å¦æˆåŠŸçš„å¸ƒå°”å€¼ã€‚

```go
t, ok := i.(T)
```

è‹¥ `i` ä¿å­˜äº†ä¸€ä¸ª `T`ï¼Œé‚£ä¹ˆ `t` å°†ä¼šæ˜¯å…¶åº•å±‚å€¼ï¼Œè€Œ `ok` ä¸º `true`ã€‚

å¦åˆ™ï¼Œ`ok` å°†ä¸º `false` è€Œ `t` å°†ä¸º `T` ç±»å‹çš„é›¶å€¼ï¼Œç¨‹åºå¹¶ä¸ä¼šäº§ç”Ÿ panicã€‚

è¯·æ³¨æ„è¿™ç§è¯­æ³•å’Œè¯»å–ä¸€ä¸ªæ˜ å°„æ—¶çš„ç›¸åŒä¹‹å¤„ã€‚

```go
package main

import "fmt"

func main() {
	var i interface{} = "hello"

	s := i.(string)
	fmt.Println(s)

	s, ok := i.(string)
	fmt.Println(s, ok)

	f, ok := i.(float64)
	fmt.Println(f, ok)

	f = i.(float64) // panic
	fmt.Println(f)
}
```

```go
hello
hello true
0 false
panic: interface conversion: interface {} is string, not float64

goroutine 1 [running]:
main.main()
	/tmp/sandbox661903849/prog.go:17 +0x13f
```

### 1. `Type(Value)` â€”â€” è¿™æ˜¯â€œå¼ºè½¬â€

 `unsafe.Pointer`ï¼Œæˆ–è€…æŠŠ `int` è½¬æˆ `float`ï¼Œè¿™å« **ç±»å‹è½¬æ¢ (Type Conversion)**ã€‚

- **è¯­æ³•**ï¼š`ç›®æ ‡ç±»å‹(å˜é‡)` â€”â€” ç±»å‹åœ¨**å‰é¢**ï¼ŒæŠŠå˜é‡åŒ…èµ·æ¥ã€‚
- **é•¿ç›¸**ï¼šè¿™å°±å¥½æ¯”æŠŠå˜é‡å¡è¿›äº†ä¸€ä¸ª**æ¨¡å…·**é‡Œï¼Œå¼ºåˆ¶å®ƒæ”¹å˜å½¢çŠ¶ã€‚
- **é€‚ç”¨åœºæ™¯**ï¼š
    - åŸºç¡€ç±»å‹äº’è½¬ï¼š`int(3.5)`
    - æŒ‡é’ˆäº’è½¬ï¼š`(*int)(unsafe.Pointer(p))`
    - è‡ªå®šä¹‰ç±»å‹äº’è½¬ï¼š`MyInt(100)`

**ä½ çš„è®°å¿†ç”»é¢ï¼ˆå¯¹çš„ï¼‰ï¼š**

```go
// è¿™é‡Œçš„ unsafe.Pointer å°±åƒä¸€ä¸ªå‡½æ•°åä¸€æ ·ï¼Œå†™åœ¨å‰é¢
p := unsafe.Pointer(ptr) 
f := float64(100)
```

------

### 2. ç°åœ¨çš„å›°æƒ‘ï¼š`Value.(Type)` â€”â€” è¿™æ˜¯â€œæ–­è¨€â€

ä½ ç°åœ¨ Go Tour é‡Œçœ‹åˆ°çš„ `i.(string)`ï¼Œè¿™å« **ç±»å‹æ–­è¨€ (Type Assertion)**ã€‚

- **è¯­æ³•**ï¼š`å˜é‡.(ç›®æ ‡ç±»å‹)` â€”â€” ç±»å‹åœ¨**åé¢**ï¼Œç”¨æ‹¬å·åŒ…ç€ã€‚
- **é•¿ç›¸**ï¼šè¿™å°±å¥½æ¯”æ‹¿ç€ä¸€ä¸ª**æ”¾å¤§é•œ**æˆ–è€…**Xå…‰**å»ç…§è¿™ä¸ªå˜é‡ï¼Œçœ‹å®ƒè‚šå­é‡Œæ˜¯ä¸æ˜¯è¿™ä¸ªç±»å‹ã€‚
- **é€‚ç”¨åœºæ™¯**ï¼š
    - **åªç”¨äºæ¥å£ (Interface)ï¼**
    - **åªç”¨äºæ¥å£ (Interface)ï¼**
    - **åªç”¨äºæ¥å£ (Interface)ï¼**

**ç°åœ¨çš„ä»£ç ï¼ˆä¹Ÿæ˜¯å¯¹çš„ï¼‰ï¼š**

```go
var i interface{} = "hello"
// i æ˜¯ä¸ªæ¥å£ï¼Œæˆ‘ä»¬è¦æ¢æµ‹å®ƒé‡Œé¢æ˜¯ä¸æ˜¯ string
s := i.(string) 
```

------

### 3. ä¸ºä»€ä¹ˆä¸ä¸€æ ·ï¼Ÿ

ä½ å¯ä»¥è¿™æ ·è®°ï¼Œè¿™ç¬¦åˆ Go çš„è®¾è®¡é€»è¾‘ï¼š

- **ç±»å‹è½¬æ¢ T(x)ï¼š**

    å®ƒçœ‹èµ·æ¥åƒä¸€ä¸ª å‡½æ•°è°ƒç”¨ Func(x)ã€‚

    å› ä¸ºä½ åœ¨åˆ›é€ ä¸€ä¸ªæ–°çš„å€¼ï¼ˆæŠŠ int å˜æˆ floatï¼Œå†…å­˜è¡¨ç¤ºéƒ½å˜äº†ï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªâ€œä¸»åŠ¨åŠ å·¥â€çš„è¿‡ç¨‹ã€‚

- **ç±»å‹æ–­è¨€ x.(T)ï¼š**

    å®ƒçœ‹èµ·æ¥åƒ è®¿é—®æˆå‘˜ x.Fieldã€‚

    å› ä¸ºä½ ä¸æ˜¯åœ¨åˆ›é€ æ–°ä¸œè¥¿ï¼Œä½ åªæ˜¯åœ¨è®¿é—® x å†…éƒ¨åŸæœ¬å°±æœ‰çš„é‚£ä¸ªå€¼ã€‚è¿™å±äº x çš„ä¸€ç§å±æ€§è®¿é—®ã€‚

### 4. æ€»ç»“

- **æƒ³æ”¹å˜å®ƒ**ï¼ˆæ¯”å¦‚ int å˜ floatï¼Œæˆ–è€…æŒ‡é’ˆä¹±æŒ‡ï¼‰ï¼šç”¨ **å‰é¢** åŒ…è£¹ -> `T(x)`
- **æƒ³çœ‹é€å®ƒ**ï¼ˆæ¥å£é‡Œé¢åˆ°åº•æ˜¯å•¥ï¼‰ï¼šç”¨ **åé¢** ç‚¹æ‹¬å· -> `x.(T)`

## 65.ç±»å‹é€‰æ‹©

**ç±»å‹é€‰æ‹©** æ˜¯ä¸€ç§æŒ‰é¡ºåºä»å‡ ä¸ªç±»å‹æ–­è¨€ä¸­é€‰æ‹©åˆ†æ”¯çš„ç»“æ„ã€‚

ç±»å‹é€‰æ‹©ä¸ä¸€èˆ¬çš„ switch è¯­å¥ç›¸ä¼¼ï¼Œä¸è¿‡ç±»å‹é€‰æ‹©ä¸­çš„ case ä¸ºç±»å‹ï¼ˆè€Œéå€¼ï¼‰ï¼Œ å®ƒä»¬é’ˆå¯¹ç»™å®šæ¥å£å€¼æ‰€å­˜å‚¨çš„å€¼çš„ç±»å‹è¿›è¡Œæ¯”è¾ƒã€‚

```go
switch v := i.(type) {
case T:
    // v çš„ç±»å‹ä¸º T
case S:
    // v çš„ç±»å‹ä¸º S
default:
    // æ²¡æœ‰åŒ¹é…ï¼Œv ä¸ i çš„ç±»å‹ç›¸åŒ
}
```

ç±»å‹é€‰æ‹©ä¸­çš„å£°æ˜ä¸ç±»å‹æ–­è¨€ `i.(T)` çš„è¯­æ³•ç›¸åŒï¼Œåªæ˜¯å…·ä½“ç±»å‹ `T` è¢«æ›¿æ¢æˆäº†å…³é”®å­— `type`ã€‚

æ­¤é€‰æ‹©è¯­å¥åˆ¤æ–­æ¥å£å€¼ `i` ä¿å­˜çš„å€¼ç±»å‹æ˜¯ `T` è¿˜æ˜¯ `S`ã€‚åœ¨ `T` æˆ– `S` çš„æƒ…å†µä¸‹ï¼Œå˜é‡ `v` ä¼šåˆ†åˆ«æŒ‰ `T` æˆ– `S` ç±»å‹ä¿å­˜ `i` æ‹¥æœ‰çš„å€¼ã€‚åœ¨é»˜è®¤ï¼ˆå³æ²¡æœ‰åŒ¹é…ï¼‰çš„æƒ…å†µä¸‹ï¼Œå˜é‡ `v` ä¸ `i` çš„æ¥å£ç±»å‹å’Œå€¼ç›¸åŒã€‚

```go
package main

import "fmt"

func do(i interface{}) {
	switch v := i.(type) {
	case int:
		fmt.Printf("äºŒå€çš„ %v æ˜¯ %v\n", v, v*2)
	case string:
		fmt.Printf("%q é•¿åº¦ä¸º %v å­—èŠ‚\n", v, len(v))
	default:
		fmt.Printf("æˆ‘ä¸çŸ¥é“ç±»å‹ %T!\n", v)
	}
}

func main() {
	do(21)
	do("hello")
	do(true)
}
```

```go
äºŒå€çš„ 21 æ˜¯ 42
"hello" é•¿åº¦ä¸º 5 å­—èŠ‚
æˆ‘ä¸çŸ¥é“ç±»å‹ bool!
```

## 66.Stringer

[`fmt`](https://go-zh.org/pkg/fmt/) åŒ…ä¸­å®šä¹‰çš„ [`Stringer`](https://go-zh.org/pkg/fmt/#Stringer) æ˜¯æœ€æ™®éçš„æ¥å£ä¹‹ä¸€ã€‚

```go
type Stringer interface {
    String() string
}
```

`Stringer` æ˜¯ä¸€ä¸ªå¯ä»¥ç”¨å­—ç¬¦ä¸²æè¿°è‡ªå·±çš„ç±»å‹ã€‚`fmt` åŒ…ï¼ˆè¿˜æœ‰å¾ˆå¤šåŒ…ï¼‰éƒ½é€šè¿‡æ­¤æ¥å£æ¥æ‰“å°å€¼ã€‚

```go
package main

import "fmt"

type Person struct {
	Name string
	Age  int
}

func (p Person) String() string {
	return fmt.Sprintf("%v (%v years)", p.Name, p.Age)
}

func main() {
	a := Person{"Arthur Dent", 42}
	z := Person{"Zaphod Beeblebrox", 9001}
	fmt.Println(a, z)
}
```

## 67.ç»ƒä¹ ï¼šStringer

é€šè¿‡è®© `IPAddr` ç±»å‹å®ç° `fmt.Stringer` æ¥æ‰“å°ç‚¹å·åˆ†éš”çš„åœ°å€ã€‚

ä¾‹å¦‚ï¼Œ`IPAddr{1, 2, 3, 4}` åº”å½“æ‰“å°ä¸º `"1.2.3.4"`ã€‚

```go
package main

import "fmt"

type IPAddr [4]byte

// TODO: ä¸º IPAddr æ·»åŠ ä¸€ä¸ª "String() string" æ–¹æ³•ã€‚

func main() {
	hosts := map[string]IPAddr{
		"loopback":  {127, 0, 0, 1},
		"googleDNS": {8, 8, 8, 8},
	}
	for name, ip := range hosts {
		fmt.Printf("%v: %v\n", name, ip)
	}
}
```

```go
loopback: 127.0.0.1
googleDNS: 8.8.8.8
```

## 68.é”™è¯¯

Go ç¨‹åºä½¿ç”¨ `error` å€¼æ¥è¡¨ç¤ºé”™è¯¯çŠ¶æ€ã€‚

ä¸ `fmt.Stringer` ç±»ä¼¼ï¼Œ`error` ç±»å‹æ˜¯ä¸€ä¸ªå†…å»ºæ¥å£ï¼š

```go
type error interface {
    Error() string
}
```

ï¼ˆä¸ `fmt.Stringer` ç±»ä¼¼ï¼Œ`fmt` åŒ…ä¹Ÿä¼šæ ¹æ®å¯¹ `error` çš„å®ç°æ¥æ‰“å°å€¼ã€‚ï¼‰

é€šå¸¸å‡½æ•°ä¼šè¿”å›ä¸€ä¸ª `error` å€¼ï¼Œè°ƒç”¨å®ƒçš„ä»£ç åº”å½“åˆ¤æ–­è¿™ä¸ªé”™è¯¯æ˜¯å¦ç­‰äº `nil` æ¥è¿›è¡Œé”™è¯¯å¤„ç†ã€‚

```go
i, err := strconv.Atoi("42")
if err != nil {
    fmt.Printf("couldn't convert number: %v\n", err)
    return
}
fmt.Println("Converted integer:", i)
```

`error` ä¸º nil æ—¶è¡¨ç¤ºæˆåŠŸï¼›é nil çš„ `error` è¡¨ç¤ºå¤±è´¥ã€‚

```go
package main

import (
	"fmt"
	"time"
)

type MyError struct {
	When time.Time
	What string
}

func (e *MyError) Error() string {
	return fmt.Sprintf("at %v, %s",
		e.When, e.What)
}

func run() error {
	return &MyError{
		time.Now(),
		"it didn't work",
	}
}

func main() {
	if err := run(); err != nil {
		fmt.Println(err)
	}
}
```

## 69.ç»ƒä¹ ï¼šé”™è¯¯

ä»[ä¹‹å‰çš„ç»ƒä¹ ](https://tour.go-zh.org/flowcontrol/8)ä¸­å¤åˆ¶ `Sqrt` å‡½æ•°ï¼Œä¿®æ”¹å®ƒä½¿å…¶è¿”å› `error` å€¼ã€‚

`Sqrt` æ¥å—åˆ°ä¸€ä¸ªè´Ÿæ•°æ—¶ï¼Œåº”å½“è¿”å›ä¸€ä¸ªé nil çš„é”™è¯¯å€¼ã€‚å¤æ•°åŒæ ·ä¹Ÿä¸è¢«æ”¯æŒã€‚

åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å‹

```go
type ErrNegativeSqrt float64
```

å¹¶ä¸ºå…¶å®ç°

```go
func (e ErrNegativeSqrt) Error() string
```

æ–¹æ³•ä½¿å…¶æ‹¥æœ‰ `error` å€¼ï¼Œé€šè¿‡ `ErrNegativeSqrt(-2).Error()` è°ƒç”¨è¯¥æ–¹æ³•åº”è¿”å› `"cannot Sqrt negative number: -2"`ã€‚

**æ³¨æ„:** åœ¨ `Error` æ–¹æ³•å†…è°ƒç”¨ `fmt.Sprint(e)` ä¼šè®©ç¨‹åºé™·å…¥æ­»å¾ªç¯ã€‚å¯ä»¥é€šè¿‡å…ˆè½¬æ¢ `e` æ¥é¿å…è¿™ä¸ªé—®é¢˜ï¼š`fmt.Sprint(float64(e))`ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

ä¿®æ”¹ `Sqrt` å‡½æ•°ï¼Œä½¿å…¶æ¥å—ä¸€ä¸ªè´Ÿæ•°æ—¶ï¼Œè¿”å› `ErrNegativeSqrt` å€¼ã€‚

```go
package main

import (
	"fmt"
)

// 1. å®šä¹‰ä¸€ä¸ªæ–°çš„ç±»å‹ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸ª float64
type ErrNegativeSqrt float64

// 2. ä¸ºè¿™ä¸ªç±»å‹å®ç° Error() æ–¹æ³•
// è¿™æ ·å®ƒå°±å˜æˆäº†ä¸€ä¸ª error (å°±åƒç©¿ä¸Šäº†é©¬ç”²)
func (e ErrNegativeSqrt) Error() string {
	// ã€å…³é”®ç‚¹ã€‘è¿™é‡Œå¿…é¡»è¦æŠŠ e è½¬æˆ float64 æ‰èƒ½æ‰“å°ï¼
	// å¦åˆ™ fmt.Sprint(e) ä¼šå†æ¬¡è°ƒç”¨ Error()ï¼Œå¯¼è‡´æ— é™é€’å½’æ­»å¾ªç¯
	return fmt.Sprintf("cannot Sqrt negative number: %v", float64(e))
}

func Sqrt(x float64) (float64, error) {
	// 3. æ£€æŸ¥ï¼šå¦‚æœæ˜¯è´Ÿæ•°
	if x < 0 {
		// è¿”å› 0 å’Œæˆ‘ä»¬è‡ªå®šä¹‰çš„é”™è¯¯
		// æ³¨æ„è¿™é‡Œè¦åšå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼šErrNegativeSqrt(x)
		return 0, ErrNegativeSqrt(x)
	}

	// å¦‚æœæ˜¯æ­£æ•°ï¼Œæ­£å¸¸è®¡ç®—ï¼ˆè¿™æ˜¯ä¹‹å‰çš„ä½œä¸šé€»è¾‘ï¼Œæˆ‘å¸®ä½ å†™äº†ä¸ªç®€ç‰ˆï¼‰
	z := 1.0
	for i := 0; i < 10; i++ {
		z -= (z*z - x) / (2 * z)
	}
	// æˆåŠŸæ—¶ï¼Œé”™è¯¯è¿”å› nil
	return z, nil
}

func main() {
	fmt.Println(Sqrt(2))
	fmt.Println(Sqrt(-2))
}
```

```go
1.414213562373095 <nil>
0 cannot Sqrt negative number: -2
```

## 70.Readers

`io` åŒ…æŒ‡å®šäº† `io.Reader` æ¥å£ï¼Œå®ƒè¡¨ç¤ºæ•°æ®æµçš„è¯»å–ç«¯ã€‚

Go æ ‡å‡†åº“åŒ…å«äº†è¯¥æ¥å£çš„[è®¸å¤šå®ç°](https://cs.opensource.google/search?q=Read\(\w%2B\s\[\]byte\)&ss=go%2Fgo)ï¼ŒåŒ…æ‹¬æ–‡ä»¶ã€ç½‘ç»œè¿æ¥ã€å‹ç¼©å’ŒåŠ å¯†ç­‰ç­‰ã€‚

`io.Reader` æ¥å£æœ‰ä¸€ä¸ª `Read` æ–¹æ³•ï¼š

```go
func (T) Read(b []byte) (n int, err error)
```

`Read` ç”¨æ•°æ®å¡«å……ç»™å®šçš„å­—èŠ‚åˆ‡ç‰‡å¹¶è¿”å›å¡«å……çš„å­—èŠ‚æ•°å’Œé”™è¯¯å€¼ã€‚åœ¨é‡åˆ°æ•°æ®æµçš„ç»“å°¾æ—¶ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª `io.EOF` é”™è¯¯ã€‚

ç¤ºä¾‹ä»£ç åˆ›å»ºäº†ä¸€ä¸ª [`strings.Reader`](https://go-zh.org/pkg/strings/#Reader) å¹¶ä»¥æ¯æ¬¡ 8 å­—èŠ‚çš„é€Ÿåº¦è¯»å–å®ƒçš„è¾“å‡ºã€‚

```go
package main

import (
	"fmt"
	"io"
	"strings"
)

func main() {
	r := strings.NewReader("Hello, Reader!")

	b := make([]byte, 8)
	for {
		n, err := r.Read(b)
		fmt.Printf("n = %v err = %v b = %v\n", n, err, b)
		fmt.Printf("b[:n] = %q\n", b[:n])
		if err == io.EOF {
			break
		}
	}
}
```

```go
n = 8 err = <nil> b = [72 101 108 108 111 44 32 82]
b[:n] = "Hello, R"
n = 6 err = <nil> b = [101 97 100 101 114 33 32 82]
b[:n] = "eader!"
n = 0 err = EOF b = [101 97 100 101 114 33 32 82]
b[:n] = ""
```

## 71.ç»ƒä¹ ï¼šReader

å®ç°ä¸€ä¸ª `Reader` ç±»å‹ï¼Œå®ƒäº§ç”Ÿä¸€ä¸ª ASCII å­—ç¬¦ `'A'` çš„æ— é™æµã€‚

```go
package main

import "golang.org/x/tour/reader"

type MyReader struct{}

func (r MyReader) Read(b []byte) (int, error) {
	// 1. éå†ä¼ è¿›æ¥çš„â€œæ¡¶â€ï¼ˆåˆ‡ç‰‡ bï¼‰
	for i := range b {
		b[i] = 'A' // 2. æŠŠæ¯ä¸ªä½ç½®éƒ½å¡«ä¸Š 'A'
	}
	
	// 3. å‘Šè¯‰è°ƒç”¨è€…ï¼šæˆ‘å¡«æ»¡äº† len(b) è¿™ä¹ˆå¤šå­—èŠ‚ï¼Œè€Œä¸”æ²¡æœ‰é”™è¯¯ï¼ˆnilï¼‰
	return len(b), nil
}

func main() {
	reader.Validate(MyReader{})
}
```

```go
OK!
```

## 72.ç»ƒä¹ ï¼šrot13Reader

æœ‰ç§å¸¸è§çš„æ¨¡å¼æ˜¯ä¸€ä¸ª [`io.Reader`](https://go-zh.org/pkg/io/#Reader) åŒ…è£…å¦ä¸€ä¸ª `io.Reader`ï¼Œç„¶åé€šè¿‡æŸç§æ–¹å¼ä¿®æ”¹å…¶æ•°æ®æµã€‚

ä¾‹å¦‚ï¼Œ[`gzip.NewReader`](https://go-zh.org/pkg/compress/gzip/#NewReader) å‡½æ•°æ¥å—ä¸€ä¸ª `io.Reader`ï¼ˆå·²å‹ç¼©çš„æ•°æ®æµï¼‰å¹¶è¿”å›ä¸€ä¸ªåŒæ ·å®ç°äº† `io.Reader` çš„ `*gzip.Reader`ï¼ˆè§£å‹åçš„æ•°æ®æµï¼‰ã€‚

ç¼–å†™ä¸€ä¸ªå®ç°äº† `io.Reader` å¹¶ä»å¦ä¸€ä¸ª `io.Reader` ä¸­è¯»å–æ•°æ®çš„ `rot13Reader`ï¼Œé€šè¿‡åº”ç”¨ [rot13](https://en.wikipedia.org/wiki/ROT13) ä»£æ¢å¯†ç å¯¹æ•°æ®æµè¿›è¡Œä¿®æ”¹ã€‚

`rot13Reader` ç±»å‹å·²ç»æä¾›ã€‚å®ç° `Read` æ–¹æ³•ä»¥æ»¡è¶³ `io.Reader`ã€‚

```go
package main

import (
	"io"
	"os"
	"strings"
)

type rot13Reader struct {
	r io.Reader
}

// æ ¸å¿ƒé€»è¾‘åœ¨è¿™é‡Œ
func (rot rot13Reader) Read(p []byte) (n int, err error) {
	// 1. å…ˆè®©åŸæœ¬çš„ Reader å»å¹²æ´»ï¼Œè¯»åˆ° p é‡Œ
	n, err = rot.r.Read(p)
	
	// 2. æ‹¿åˆ°æ•°æ®åï¼Œæˆ‘ä»¬åœ¨åŸåœ°è¿›è¡Œâ€œåŠ å¯†/è§£å¯†â€ä¿®æ”¹
	// æ³¨æ„ï¼šåªä¿®æ”¹å‰ n ä¸ªå­—èŠ‚ï¼
	for i := 0; i < n; i++ {
		c := p[i]
		// å¦‚æœæ˜¯å‰åŠæ®µå­—æ¯(A-M, a-m)ï¼Œå°± +13
		if (c >= 'A' && c <= 'M') || (c >= 'a' && c <= 'm') {
			p[i] += 13
		// å¦‚æœæ˜¯ååŠæ®µå­—æ¯(N-Z, n-z)ï¼Œå°± -13
		} else if (c >= 'N' && c <= 'Z') || (c >= 'n' && c <= 'z') {
			p[i] -= 13
		}
		// å…¶ä»–å­—ç¬¦ï¼ˆç©ºæ ¼ã€æ ‡ç‚¹ï¼‰ä¸åŠ¨
	}
	
	// 3. è¿”å›ä¿®æ”¹åçš„ç»“æœ
	return n, err
}

func main() {
	s := strings.NewReader("Lbh penpxrq gur pbqr!")
	r := rot13Reader{s}
	io.Copy(os.Stdout, &r)
}
```

```go
You cracked the code!
```

## 73.ç±»å‹å‚æ•°

å¯ä»¥ä½¿ç”¨ç±»å‹å‚æ•°ç¼–å†™ Go å‡½æ•°æ¥å¤„ç†å¤šç§ç±»å‹ã€‚ å‡½æ•°çš„ç±»å‹å‚æ•°å‡ºç°åœ¨å‡½æ•°å‚æ•°ä¹‹å‰çš„æ–¹æ‹¬å·ä¹‹é—´ã€‚

```go
func Index[T comparable](s []T, x T) int
```

æ­¤å£°æ˜æ„å‘³ç€ `s` æ˜¯æ»¡è¶³å†…ç½®çº¦æŸ `comparable` çš„ä»»ä½•ç±»å‹ `T` çš„åˆ‡ç‰‡ã€‚ `x` ä¹Ÿæ˜¯ç›¸åŒç±»å‹çš„å€¼ã€‚

`comparable` æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„çº¦æŸï¼Œå®ƒèƒ½è®©æˆ‘ä»¬å¯¹ä»»æ„æ»¡è¶³è¯¥ç±»å‹çš„å€¼ä½¿ç”¨ `==` å’Œ `!=` è¿ç®—ç¬¦ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒå°†å€¼ä¸æ‰€æœ‰åˆ‡ç‰‡å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œç›´åˆ°æ‰¾åˆ°åŒ¹é…é¡¹ã€‚ è¯¥ `Index` å‡½æ•°é€‚ç”¨äºä»»ä½•æ”¯æŒæ¯”è¾ƒçš„ç±»å‹ã€‚

```go
package main

import "fmt"

// Index è¿”å› x åœ¨ s ä¸­çš„ä¸‹æ ‡ï¼Œæœªæ‰¾åˆ°åˆ™è¿”å› -1ã€‚
func Index[T comparable](s []T, x T) int {
	for i, v := range s {
		// v å’Œ x çš„ç±»å‹ä¸º Tï¼Œå®ƒæ‹¥æœ‰ comparable å¯æ¯”è¾ƒçš„çº¦æŸï¼Œ
		// å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ==ã€‚
		if v == x {
			return i
		}
	}
	return -1
}

func main() {
	// Index å¯ä»¥åœ¨æ•´æ•°åˆ‡ç‰‡ä¸Šä½¿ç”¨
	si := []int{10, 20, 15, -10}
	fmt.Println(Index(si, 15))

	// Index ä¹Ÿå¯ä»¥åœ¨å­—ç¬¦ä¸²åˆ‡ç‰‡ä¸Šä½¿ç”¨
	ss := []string{"foo", "bar", "baz"}
	fmt.Println(Index(ss, "hello"))
}
```

```go
2
-1
```

## 74.æ³›å‹ç±»å‹

é™¤äº†æ³›å‹å‡½æ•°ä¹‹å¤–ï¼ŒGo è¿˜æ”¯æŒæ³›å‹ç±»å‹ã€‚ ç±»å‹å¯ä»¥ä½¿ç”¨ç±»å‹å‚æ•°è¿›è¡Œå‚æ•°åŒ–ï¼Œè¿™å¯¹äºå®ç°é€šç”¨æ•°æ®ç»“æ„éå¸¸æœ‰ç”¨ã€‚

æ­¤ç¤ºä¾‹å±•ç¤ºäº†èƒ½å¤Ÿä¿å­˜ä»»æ„ç±»å‹å€¼çš„å•é“¾è¡¨çš„ç®€å•ç±»å‹å£°æ˜ã€‚

ä½œä¸ºç»ƒä¹ ï¼Œè¯·ä¸ºæ­¤é“¾è¡¨çš„å®ç°æ·»åŠ ä¸€äº›åŠŸèƒ½ã€‚

```go
package main

// List è¡¨ç¤ºä¸€ä¸ªå¯ä»¥ä¿å­˜ä»»ä½•ç±»å‹çš„å€¼çš„å•é“¾è¡¨ã€‚
type List[T any] struct {
	next *List[T]
	val  T
}

func main() {
}
```

## 75.Go åç¨‹

Go ç¨‹ï¼ˆgoroutineï¼‰æ˜¯ç”± Go è¿è¡Œæ—¶ç®¡ç†çš„è½»é‡çº§çº¿ç¨‹ã€‚

```
go f(x, y, z)
```

ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„ Go åç¨‹å¹¶æ‰§è¡Œ

```
f(x, y, z)
```

`f`, `x`, `y` å’Œ `z` çš„æ±‚å€¼å‘ç”Ÿåœ¨å½“å‰çš„ Go åç¨‹ä¸­ï¼Œè€Œ `f` çš„æ‰§è¡Œå‘ç”Ÿåœ¨æ–°çš„ Go åç¨‹ä¸­ã€‚

Go ç¨‹åœ¨ç›¸åŒçš„åœ°å€ç©ºé—´ä¸­è¿è¡Œï¼Œå› æ­¤åœ¨è®¿é—®å…±äº«çš„å†…å­˜æ—¶å¿…é¡»è¿›è¡ŒåŒæ­¥ã€‚[`sync`](https://go-zh.org/pkg/sync/) åŒ…æä¾›äº†è¿™ç§èƒ½åŠ›ï¼Œä¸è¿‡åœ¨ Go ä¸­å¹¶ä¸ç»å¸¸ç”¨åˆ°ï¼Œå› ä¸ºè¿˜æœ‰å…¶å®ƒçš„åŠæ³•ï¼ˆè§ä¸‹ä¸€é¡µï¼‰ã€‚

```go
package main

import (
	"fmt"
	"time"
)

func say(s string) {
	for i := 0; i < 5; i++ {
		time.Sleep(100 * time.Millisecond)
		fmt.Println(s)
	}
}

func main() {
	go say("world")
	say("hello")
}
```

```go
hello
world
world
hello
hello
world
world
hello
hello
```

## 76.ä¿¡é“

ä¿¡é“æ˜¯å¸¦æœ‰ç±»å‹çš„ç®¡é“ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒç”¨ä¿¡é“æ“ä½œç¬¦ `<-` æ¥å‘é€æˆ–è€…æ¥æ”¶å€¼ã€‚

```go
ch <- v    // å°† v å‘é€è‡³ä¿¡é“ chã€‚
v := <-ch  // ä» ch æ¥æ”¶å€¼å¹¶èµ‹äºˆ vã€‚
```

ï¼ˆâ€œç®­å¤´â€å°±æ˜¯æ•°æ®æµçš„æ–¹å‘ã€‚ï¼‰

å’Œæ˜ å°„ä¸åˆ‡ç‰‡ä¸€æ ·ï¼Œä¿¡é“åœ¨ä½¿ç”¨å‰å¿…é¡»åˆ›å»ºï¼š

```go
ch := make(chan int)
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘é€å’Œæ¥æ”¶æ“ä½œåœ¨å¦ä¸€ç«¯å‡†å¤‡å¥½ä¹‹å‰éƒ½ä¼šé˜»å¡ã€‚è¿™ä½¿å¾— Go ç¨‹å¯ä»¥åœ¨æ²¡æœ‰æ˜¾å¼çš„é”æˆ–ç«æ€å˜é‡çš„æƒ…å†µä¸‹è¿›è¡ŒåŒæ­¥ã€‚

ä»¥ä¸‹ç¤ºä¾‹å¯¹åˆ‡ç‰‡ä¸­çš„æ•°è¿›è¡Œæ±‚å’Œï¼Œå°†ä»»åŠ¡åˆ†é…ç»™ä¸¤ä¸ª Go ç¨‹ã€‚ä¸€æ—¦ä¸¤ä¸ª Go ç¨‹å®Œæˆäº†å®ƒä»¬çš„è®¡ç®—ï¼Œå®ƒå°±èƒ½ç®—å‡ºæœ€ç»ˆçš„ç»“æœã€‚

```go
package main

import "fmt"

func sum(s []int, c chan int) {
	sum := 0
	for _, v := range s {
		sum += v
	}
	c <- sum // å‘é€ sum åˆ° c
}

func main() {
	s := []int{7, 2, 8, -9, 4, 0}

	c := make(chan int)
	go sum(s[:len(s)/2], c)
	go sum(s[len(s)/2:], c)
	x, y := <-c, <-c // ä» c æ¥æ”¶

	fmt.Println(x, y, x+y)
}

// -5 17 12
```

## 77.å¸¦ç¼“å†²çš„ä¿¡é“

ä¿¡é“å¯ä»¥æ˜¯ **å¸¦ç¼“å†²çš„**ã€‚å°†ç¼“å†²é•¿åº¦ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°æä¾›ç»™ `make` æ¥åˆå§‹åŒ–ä¸€ä¸ªå¸¦ç¼“å†²çš„ä¿¡é“ï¼š

```go
ch := make(chan int, 100)
```

ä»…å½“ä¿¡é“çš„ç¼“å†²åŒºå¡«æ»¡åï¼Œå‘å…¶å‘é€æ•°æ®æ—¶æ‰ä¼šé˜»å¡ã€‚å½“ç¼“å†²åŒºä¸ºç©ºæ—¶ï¼Œæ¥å—æ–¹ä¼šé˜»å¡ã€‚

ä¿®æ”¹ç¤ºä¾‹å¡«æ»¡ç¼“å†²åŒºï¼Œç„¶åçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚

```go
package main

import "fmt"

func main() {
	ch := make(chan int, 2)
	ch <- 1
	ch <- 2
	fmt.Println(<-ch)
	fmt.Println(<-ch)
}
// 1
// 2
```

**æœ‰ç¼“å†²çš„ä¿¡é“ï¼Œä¸€æ—¦ç”Ÿäº§è€…ç”Ÿäº§å‡ºæ¥çš„ä¸œè¥¿æ”¾å…¥äº†ç¼“å†²åŒºï¼Œç”Ÿäº§è€…å°±å¯ä»¥è§£æ”¾äº†ï¼Œä½†æ˜¯å¦‚æœæ˜¯æ— ç¼“å†²çš„ä¿¡é“ï¼Œç”Ÿäº§è€…ç”Ÿäº§å‡ºæ¥çš„ä¸œè¥¿å¦‚æœæ²¡è¢«æ¶ˆè´¹è€…æ¶ˆåŒ–ï¼Œå°±ä¸€ç›´å¾—ç­‰ç€è§£æ”¾ä¸äº†.**

### 1. æ— ç¼“å†²ä¿¡é“ (Unbuffered) â€”â€” â€œä¸è§ä¸æ•£çš„çº¦ä¼šâ€

- **åœºæ™¯**ï¼šä½ è¦ç»™å¥³æœ‹å‹é€èŠ±ã€‚
- **è§„åˆ™**ï¼šå¿…é¡»äº²æ‰‹äº¤ç»™å¥¹ï¼ˆUnbufferedï¼‰ã€‚
- **åæœ**ï¼š
    - å¦‚æœä½ åˆ°äº†æ¥¼ä¸‹ï¼Œå¥¹è¿˜åœ¨åŒ–å¦†ï¼ˆæ¶ˆè´¹è€…æ²¡å‡†å¤‡å¥½ï¼‰ï¼Œä½ èƒ½åœ¨æ¥¼ä¸‹æŠŠèŠ±æ‰”äº†å°±èµ°å—ï¼Ÿ**ä¸èƒ½ï¼**
    - **ä½ å¿…é¡»åœ¨å¤§å¤ªé˜³åº•ä¸‹æ­»ç­‰ï¼ˆé˜»å¡ï¼‰**ï¼Œç›´åˆ°å¥¹ä¸‹æ¥¼ï¼Œä½ æŠŠèŠ±äº¤åˆ°å¥¹æ‰‹é‡Œï¼Œä½ æ‰èƒ½ç¦»å¼€å»å¹²åˆ«çš„äº‹ã€‚
- **ä»£ç é‡Œ**ï¼šDocker è·‘å®Œäº†ï¼Œæƒ³æŠŠæ•°æ®ç»™ä¸»ç¨‹åºï¼Œä½†ä¸»ç¨‹åºåœ¨å¿™ã€‚Docker åç¨‹å°±å¡åœ¨å†…å­˜é‡Œï¼Œä¸èƒ½é”€æ¯ï¼Œç›´åˆ°ä¸»ç¨‹åºæ¥æ‹¿æ•°æ®ã€‚

### 2. æœ‰ç¼“å†²ä¿¡é“ (Buffered) â€”â€” â€œå¿«é€’æŸœæ¨¡å¼â€

- **åœºæ™¯**ï¼šå¿«é€’å‘˜é€å¿«é€’ã€‚
- **è§„åˆ™**ï¼šæ¥¼ä¸‹æœ‰ 5 ä¸ªæ ¼å­çš„ä¸°å·¢å¿«é€’æŸœï¼ˆ`make(chan int, 5)`ï¼‰ã€‚
- **åæœ**ï¼š
    - å¿«é€’å‘˜ï¼ˆç”Ÿäº§è€…ï¼‰åˆ°äº†ï¼Œçœ‹æŸœå­æœ‰ç©ºä½ï¼Œ**æŠŠåŒ…è£¹å¾€é‡Œé¢ä¸€å¡ï¼ˆå‘é€æ•°æ®ï¼‰ï¼Œå…³é—¨ï¼Œç›´æ¥éª‘è½¦èµ°äººï¼ˆåç¨‹ç»“æŸï¼Œèµ„æºé‡Šæ”¾ï¼‰ã€‚**
    - ä»–æ ¹æœ¬ä¸åœ¨ä¹ä½ ï¼ˆæ¶ˆè´¹è€…ï¼‰æ˜¯åœ¨ç¡è§‰è¿˜æ˜¯åœ¨ä¸Šç­ï¼Œåæ­£ä¸œè¥¿æ”¾æŸœå­é‡Œäº†ï¼Œä½ æœ‰ç©ºè‡ªå·±æ¥æ‹¿ã€‚
- **ä»£ç é‡Œ**ï¼šDocker è·‘å®Œäº†ï¼Œæ•°æ®ä¸¢è¿›ç¼“å†²åŒºï¼Œåç¨‹ç«‹åˆ»é”€æ¯ï¼Œå†…å­˜ç¬é—´é‡Šæ”¾ã€‚ä¸»ç¨‹åºçˆ±å•¥æ—¶å€™æ‹¿å•¥æ—¶å€™æ‹¿ã€‚

### 3. å”¯ä¸€çš„ä¸€ä¸ªâ€œä½†æ˜¯â€

æ—¢ç„¶æœ‰ç¼“å†²è¿™ä¹ˆçˆ½ï¼Œæ˜¯ä¸æ˜¯ç¼“å†²åŒºè¶Šå¤§è¶Šå¥½ï¼Ÿæ¯”å¦‚å¼€ä¸ª 100 ä¸‡çš„ç¼“å†²åŒºï¼Ÿ

æ³¨æ„ï¼š

å¦‚æœ å¿«é€’æŸœå¡æ»¡äº†ï¼ˆç¼“å†²åŒºæ»¡äº†ï¼‰ï¼Œé‚£ç§æƒ…å†µä¸‹ï¼Œæœ‰ç¼“å†²ä¿¡é“å°±ä¼šç¬é—´é€€åŒ–æˆæ— ç¼“å†²ä¿¡é“ï¼

- å¿«é€’å‘˜æ¥äº†ï¼Œå‘ç° 5 ä¸ªæ ¼å­å…¨æ»¡äº†ã€‚
- ä»–ä¹Ÿä¸èƒ½èµ°ï¼ä»–å¿…é¡»æŠ±ç€å¿«é€’åœ¨æŸœå­å‰**æ­»ç­‰**ï¼Œç­‰åˆ°æœ‰ä¸ªäººæ¥å–èµ°ä¸€ä»¶å¿«é€’ï¼ˆè…¾å‡ºä¸€ä¸ªç©ºä½ï¼‰ï¼Œä»–æ‰èƒ½å¡è¿›å»ç„¶åèµ°äººã€‚

## 78.range å’Œ close

å‘é€è€…å¯é€šè¿‡ `close` å…³é—­ä¸€ä¸ªä¿¡é“æ¥è¡¨ç¤ºæ²¡æœ‰éœ€è¦å‘é€çš„å€¼äº†ã€‚æ¥æ”¶è€…å¯ä»¥é€šè¿‡ä¸ºæ¥æ”¶è¡¨è¾¾å¼åˆ†é…ç¬¬äºŒä¸ªå‚æ•°æ¥æµ‹è¯•ä¿¡é“æ˜¯å¦è¢«å…³é—­ï¼šè‹¥æ²¡æœ‰å€¼å¯ä»¥æ¥æ”¶ä¸”ä¿¡é“å·²è¢«å…³é—­ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œå®Œ

```go
v, ok := <-ch
```

æ­¤æ—¶ `ok` ä¼šè¢«è®¾ç½®ä¸º `false`ã€‚

å¾ªç¯ `for i := range c` ä¼šä¸æ–­ä»ä¿¡é“æ¥æ”¶å€¼ï¼Œç›´åˆ°å®ƒè¢«å…³é—­ã€‚

**æ³¨æ„**ï¼š åªåº”ç”±å‘é€è€…å…³é—­ä¿¡é“ï¼Œè€Œä¸åº”ç”±æ¥æ”¶è€…å…³é—­ã€‚å‘ä¸€ä¸ªå·²ç»å…³é—­çš„ä¿¡é“å‘é€æ•°æ®ä¼šå¼•å‘ç¨‹åº panicã€‚

**è¿˜è¦æ³¨æ„**ï¼š ä¿¡é“ä¸æ–‡ä»¶ä¸åŒï¼Œé€šå¸¸æƒ…å†µä¸‹æ— éœ€å…³é—­å®ƒä»¬ã€‚åªæœ‰åœ¨å¿…é¡»å‘Šè¯‰æ¥æ”¶è€…ä¸å†æœ‰éœ€è¦å‘é€çš„å€¼æ—¶æ‰æœ‰å¿…è¦å…³é—­ï¼Œä¾‹å¦‚ç»ˆæ­¢ä¸€ä¸ª `range` å¾ªç¯ã€‚

```go
package main

import (
	"fmt"
)

func fibonacci(n int, c chan int) {
	x, y := 0, 1
	for i := 0; i < n; i++ {
		c <- x
		x, y = y, x+y
	}
	close(c)
}

func main() {
	c := make(chan int, 10)
	go fibonacci(cap(c), c)
	for i := range c {
		fmt.Println(i)
	}
}
```

```go
0
1
1
2
3
5
8
13
21
34
```

## 79.select è¯­å¥

`select` è¯­å¥ä½¿ä¸€ä¸ª Go ç¨‹å¯ä»¥ç­‰å¾…å¤šä¸ªé€šä¿¡æ“ä½œã€‚

`select` ä¼šé˜»å¡åˆ°æŸä¸ªåˆ†æ”¯å¯ä»¥ç»§ç»­æ‰§è¡Œä¸ºæ­¢ï¼Œè¿™æ—¶å°±ä¼šæ‰§è¡Œè¯¥åˆ†æ”¯ã€‚å½“å¤šä¸ªåˆ†æ”¯éƒ½å‡†å¤‡å¥½æ—¶ä¼šéšæœºé€‰æ‹©ä¸€ä¸ªæ‰§è¡Œã€‚

```go
package main

import "fmt"

func fibonacci(c, quit chan int) {
	x, y := 0, 1
	for {
		select {
		case c <- x:
			x, y = y, x+y
		case <-quit:
			fmt.Println("quit")
			return
		}
	}
}

func main() {
	c := make(chan int)
	quit := make(chan int)
	go func() {
		for i := 0; i < 10; i++ {
			fmt.Println(<-c)
		}
		quit <- 0
	}()
	fibonacci(c, quit)
}
```

```go
0
1
1
2
3
5
8
13
21
34
quit
```

## 80.é»˜è®¤é€‰æ‹©

å½“ `select` ä¸­çš„å…¶å®ƒåˆ†æ”¯éƒ½æ²¡æœ‰å‡†å¤‡å¥½æ—¶ï¼Œ`default` åˆ†æ”¯å°±ä¼šæ‰§è¡Œã€‚

ä¸ºäº†åœ¨å°è¯•å‘é€æˆ–è€…æ¥æ”¶æ—¶ä¸å‘ç”Ÿé˜»å¡ï¼Œå¯ä½¿ç”¨ `default` åˆ†æ”¯ï¼š

```go
select {
case i := <-c:
    // ä½¿ç”¨ i
default:
    // ä» c ä¸­æ¥æ”¶ä¼šé˜»å¡æ—¶æ‰§è¡Œ
}
```

```go
package main

import (
	"fmt"
	"time"
)

func main() {
	tick := time.Tick(100 * time.Millisecond)
	boom := time.After(500 * time.Millisecond)
	for {
		select {
		case <-tick:
			fmt.Println("tick.")
		case <-boom:
			fmt.Println("BOOM!")
			return
		default:
			fmt.Println("    .")
			time.Sleep(50 * time.Millisecond)
		}
	}
}

```

```go
    .
    .
tick.
    .
    .
tick.
    .
    .
tick.
    .
    .
tick.
    .
    .
BOOM!
```

## 81.Context

```go
package main

import (
	"context"
	"fmt"
	"time"
)

func runTask(ctx context.Context, id int) {
	for {
		select {
		case <-ctx.Done(): // æ”¶åˆ°â€œåœç«â€æŒ‡ä»¤
			fmt.Printf("Agent %d: æ”¶åˆ°æ’¤é€€ä¿¡å·ï¼Œæ­£åœ¨è‡ªæ¯...\n", id)
			return
		default:
			// æ­£å¸¸å¹²æ´»
			fmt.Printf("Agent %d: æ­£åœ¨ç–¯ç‹‚è·‘åˆ†...\n", id)
			time.Sleep(500 * time.Millisecond)
		}
	}
}

func main() {
	// 1. åˆ›å»ºä¸€ä¸ªå¸¦â€œè‡ªçˆ†æŒ‰é’®â€çš„ä¸Šä¸‹æ–‡
	ctx, cancel := context.WithCancel(context.Background())

	go runTask(ctx, 1)
	go runTask(ctx, 2)

	time.Sleep(2 * time.Second)
	fmt.Println("ğŸ“¢ ç”¨æˆ·å–æ¶ˆäº†æ¯”èµ›ï¼")

	// 2. æŒ‰ä¸‹æŒ‰é’®ï¼Œæ‰€æœ‰å¸¦ç€è¿™ä¸ª ctx çš„åç¨‹éƒ½ä¼šç¬é—´æ”¶åˆ°ä¿¡å·å¹¶é€€å‡º
	cancel()

	time.Sleep(1 * time.Second)
	fmt.Println("æ‰€æœ‰ Agent å·²æ’¤é€€ã€‚")
}

```

```go
Agent 1: æ­£åœ¨ç–¯ç‹‚è·‘åˆ†...
Agent 2: æ­£åœ¨ç–¯ç‹‚è·‘åˆ†...
Agent 2: æ­£åœ¨ç–¯ç‹‚è·‘åˆ†...
Agent 1: æ­£åœ¨ç–¯ç‹‚è·‘åˆ†...
Agent 1: æ­£åœ¨ç–¯ç‹‚è·‘åˆ†...
Agent 2: æ­£åœ¨ç–¯ç‹‚è·‘åˆ†...
Agent 1: æ­£åœ¨ç–¯ç‹‚è·‘åˆ†...
Agent 2: æ­£åœ¨ç–¯ç‹‚è·‘åˆ†...
ğŸ“¢ ç”¨æˆ·å–æ¶ˆäº†æ¯”èµ›ï¼
Agent 1: æ”¶åˆ°æ’¤é€€ä¿¡å·ï¼Œæ­£åœ¨è‡ªæ¯...
Agent 2: æ”¶åˆ°æ’¤é€€ä¿¡å·ï¼Œæ­£åœ¨è‡ªæ¯...
æ‰€æœ‰ Agent å·²æ’¤é€€ã€‚
```

## 82.sync.Mutex

æˆ‘ä»¬å·²ç»çœ‹åˆ°ä¿¡é“éå¸¸é€‚åˆåœ¨å„ä¸ª Go ç¨‹é—´è¿›è¡Œé€šä¿¡ã€‚

ä½†æ˜¯å¦‚æœæˆ‘ä»¬å¹¶ä¸éœ€è¦é€šä¿¡å‘¢ï¼Ÿæ¯”å¦‚è¯´ï¼Œè‹¥æˆ‘ä»¬åªæ˜¯æƒ³ä¿è¯æ¯æ¬¡åªæœ‰ä¸€ä¸ª Go ç¨‹èƒ½å¤Ÿè®¿é—®ä¸€ä¸ªå…±äº«çš„å˜é‡ï¼Œä»è€Œé¿å…å†²çªï¼Ÿ

è¿™é‡Œæ¶‰åŠçš„æ¦‚å¿µå«åš *äº’æ–¥ï¼ˆmutual*exclusionï¼‰* ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ *äº’æ–¥é”ï¼ˆMutexï¼‰* è¿™ä¸€æ•°æ®ç»“æ„æ¥æä¾›è¿™ç§æœºåˆ¶ã€‚

Go æ ‡å‡†åº“ä¸­æä¾›äº† [`sync.Mutex`](https://go-zh.org/pkg/sync/#Mutex) äº’æ–¥é”ç±»å‹åŠå…¶ä¸¤ä¸ªæ–¹æ³•ï¼š

- `Lock`
- `Unlock`

æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ä»£ç å‰è°ƒç”¨ `Lock` æ–¹æ³•ï¼Œåœ¨ä»£ç åè°ƒç”¨ `Unlock` æ–¹æ³•æ¥ä¿è¯ä¸€æ®µä»£ç çš„äº’æ–¥æ‰§è¡Œã€‚å‚è§ `Inc` æ–¹æ³•ã€‚

æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ `defer` è¯­å¥æ¥ä¿è¯äº’æ–¥é”ä¸€å®šä¼šè¢«è§£é”ã€‚å‚è§ `Value` æ–¹æ³•ã€‚

```go
package main

import (
	"fmt"
	"sync"
	"time"
)

// SafeCounter æ˜¯å¹¶å‘å®‰å…¨çš„
type SafeCounter struct {
	mu sync.Mutex
	v  map[string]int
}

// Inc å¯¹ç»™å®šé”®çš„è®¡æ•°åŠ ä¸€
func (c *SafeCounter) Inc(key string) {
	c.mu.Lock()
	// é”å®šä½¿å¾—ä¸€æ¬¡åªæœ‰ä¸€ä¸ª Go åç¨‹å¯ä»¥è®¿é—®æ˜ å°„ c.vã€‚
	c.v[key]++
	c.mu.Unlock()
}

// Value è¿”å›ç»™å®šé”®çš„è®¡æ•°çš„å½“å‰å€¼ã€‚
func (c *SafeCounter) Value(key string) int {
	c.mu.Lock()
	// é”å®šä½¿å¾—ä¸€æ¬¡åªæœ‰ä¸€ä¸ª Go åç¨‹å¯ä»¥è®¿é—®æ˜ å°„ c.vã€‚
	defer c.mu.Unlock()
	return c.v[key]
}

func main() {
	c := SafeCounter{v: make(map[string]int)}
	for i := 0; i < 1000; i++ {
		go c.Inc("somekey")
	}

	time.Sleep(time.Second)
	fmt.Println(c.Value("somekey"))
}
```
